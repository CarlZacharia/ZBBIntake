<div class="scenario-container" *ngIf="scenario">
  <h2 class="scenario-title">Scenario: {{ clientName }} Passes First</h2>
  <p class="scenario-description">
    This scenario shows how assets would be distributed if {{ clientName }} passes away first,
    with {{ spouseName }} surviving.
  </p>

  <!-- Summary Cards -->
  <div class="summary-cards">
    <div class="summary-card probate">
      <div class="card-label">Client Probate</div>
      <div class="card-value">{{ scenario.clientProbateTotal | currency:'USD':'symbol':'1.0-0' }}</div>
    </div>
    <div class="summary-card non-probate">
      <div class="card-label">Client Non-Probate</div>
      <div class="card-value">{{ scenario.clientNonProbateTotal | currency:'USD':'symbol':'1.0-0' }}</div>
    </div>
    <div class="summary-card joint-spouse">
      <div class="card-label">To Spouse (Survivorship)</div>
      <div class="card-value">{{ scenario.clientJointSpouseTotal | currency:'USD':'symbol':'1.0-0' }}</div>
    </div>
    <div class="summary-card other">
      <div class="card-label">To Others</div>
      <div class="card-value">{{ (scenario.clientOtherTotal + scenario.clientJointOtherTotal) | currency:'USD':'symbol':'1.0-0' }}</div>
    </div>
    <div class="summary-card spouse-sole">
      <div class="card-label">Spouse Retains</div>
      <div class="card-value">{{ scenario.spouseSoleTotal | currency:'USD':'symbol':'1.0-0' }}</div>
    </div>
    <div class="summary-card entity">
      <div class="card-label">Entity Assets</div>
      <div class="card-value">{{ (scenario.trustAssetsTotal + scenario.llcAssetsTotal) | currency:'USD':'symbol':'1.0-0' }}</div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- CLIENT PROBATE ASSETS -->
  <!-- ============================================================ -->
  <div class="section-divider"></div>
  <ng-container *ngIf="scenario.clientProbate.length; else noClientProbate">
    <h3 class="table-section-title probate-title">Client Probate Assets</h3>
    <p class="section-note">Assets passing through {{ clientName }}'s estate via probate</p>
    <table class="scenario-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Transfer Method</th>
          <th class="text-center">Inheritors</th>
          <th class="text-right">Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of scenario.clientProbate">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ transferMechanismLabel(asset.transferMechanism) }}</td>
            <td class="text-center">
              <span class="inheritor-toggle" (click)="toggleAssetDetails(asset)">
                {{ asset.inheritors.length }} {{ asset.inheritors.length === 1 ? 'Inheritor' : 'Inheritors' }}
                <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.calculatedValue | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="isExpanded(asset)" class="detail-row">
            <td colspan="5">
              <div class="inheritor-details">
                <table class="inheritor-subtable">
                  <thead>
                    <tr>
                      <th>Inheritor</th>
                      <th>Relationship</th>
                      <th class="text-right">Share</th>
                      <th class="text-right">Value</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let inheritor of asset.inheritors">
                      <td>{{ inheritor.name }}</td>
                      <td>{{ inheritor.relationship }}</td>
                      <td class="text-right">{{ formatPercent(inheritor.percentage) }}</td>
                      <td class="text-right">{{ inheritor.value | currency:'USD':'symbol':'1.0-0' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ scenario.clientProbateTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noClientProbate>
    <h3 class="table-section-title probate-title">Client Probate Assets</h3>
    <p class="no-assets-message">No assets passing through probate</p>
  </ng-template>

  <!-- ============================================================ -->
  <!-- CLIENT NON-PROBATE ASSETS -->
  <!-- ============================================================ -->
  <ng-container *ngIf="scenario.clientNonProbate.length; else noClientNonProbate">
    <h3 class="table-section-title non-probate-title">Client Non-Probate Assets</h3>
    <p class="section-note">Assets passing by beneficiary designation, life estate, or deed</p>
    <table class="scenario-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Transfer Method</th>
          <th class="text-center">Inheritors</th>
          <th class="text-right">Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of scenario.clientNonProbate">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ transferMechanismLabel(asset.transferMechanism) }}</td>
            <td class="text-center">
              <span class="inheritor-toggle" (click)="toggleAssetDetails(asset)">
                {{ asset.inheritors.length }} {{ asset.inheritors.length === 1 ? 'Inheritor' : 'Inheritors' }}
                <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.calculatedValue | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="isExpanded(asset)" class="detail-row">
            <td colspan="5">
              <div class="inheritor-details">
                <table class="inheritor-subtable">
                  <thead>
                    <tr>
                      <th>Inheritor</th>
                      <th>Relationship</th>
                      <th class="text-right">Share</th>
                      <th class="text-right">Value</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let inheritor of asset.inheritors">
                      <td>{{ inheritor.name }}</td>
                      <td>{{ inheritor.relationship }}</td>
                      <td class="text-right">{{ formatPercent(inheritor.percentage) }}</td>
                      <td class="text-right">{{ inheritor.value | currency:'USD':'symbol':'1.0-0' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ scenario.clientNonProbateTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noClientNonProbate>
    <h3 class="table-section-title non-probate-title">Client Non-Probate Assets</h3>
    <p class="no-assets-message">No non-probate assets</p>
  </ng-template>

  <!-- ============================================================ -->
  <!-- CLIENT JOINT WITH SPOUSE -->
  <!-- ============================================================ -->
  <ng-container *ngIf="scenario.clientJointSpouse.length; else noClientJointSpouse">
    <h3 class="table-section-title joint-spouse-title">Assets Passing to {{ spouseName }} by Survivorship</h3>
    <p class="section-note">Jointly-owned assets passing to {{ spouseName }} by right of survivorship</p>
    <table class="scenario-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Transfer Method</th>
          <th class="text-center">Inheritors</th>
          <th class="text-right">Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of scenario.clientJointSpouse">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ transferMechanismLabel(asset.transferMechanism) }}</td>
            <td class="text-center">
              <span class="inheritor-toggle" (click)="toggleAssetDetails(asset)">
                {{ asset.inheritors.length }} {{ asset.inheritors.length === 1 ? 'Inheritor' : 'Inheritors' }}
                <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.calculatedValue | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="isExpanded(asset)" class="detail-row">
            <td colspan="5">
              <div class="inheritor-details">
                <table class="inheritor-subtable">
                  <thead>
                    <tr>
                      <th>Inheritor</th>
                      <th>Relationship</th>
                      <th class="text-right">Share</th>
                      <th class="text-right">Value</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let inheritor of asset.inheritors">
                      <td>{{ inheritor.name }}</td>
                      <td>{{ inheritor.relationship }}</td>
                      <td class="text-right">{{ formatPercent(inheritor.percentage) }}</td>
                      <td class="text-right">{{ inheritor.value | currency:'USD':'symbol':'1.0-0' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ scenario.clientJointSpouseTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noClientJointSpouse>
    <h3 class="table-section-title joint-spouse-title">Assets Passing to {{ spouseName }} by Survivorship</h3>
    <p class="no-assets-message">No jointly-owned assets with spouse</p>
  </ng-template>

  <!-- ============================================================ -->
  <!-- CLIENT OTHER (Passes to non-spouse joint owners) -->
  <!-- ============================================================ -->
  <ng-container *ngIf="scenario.clientOther.length; else noClientOther">
    <h3 class="table-section-title other-title">Assets Passing to Other Joint Owners</h3>
    <p class="section-note">Assets passing to non-spouse joint owners by survivorship or retained by them</p>
    <table class="scenario-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Transfer Method</th>
          <th class="text-center">Inheritors</th>
          <th class="text-right">Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of scenario.clientOther">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ transferMechanismLabel(asset.transferMechanism) }}</td>
            <td class="text-center">
              <span class="inheritor-toggle" (click)="toggleAssetDetails(asset)">
                {{ asset.inheritors.length }} {{ asset.inheritors.length === 1 ? 'Inheritor' : 'Inheritors' }}
                <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.calculatedValue | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="isExpanded(asset)" class="detail-row">
            <td colspan="5">
              <div class="inheritor-details">
                <table class="inheritor-subtable">
                  <thead>
                    <tr>
                      <th>Inheritor</th>
                      <th>Relationship</th>
                      <th class="text-right">Share</th>
                      <th class="text-right">Value</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let inheritor of asset.inheritors">
                      <td>{{ inheritor.name }}</td>
                      <td>{{ inheritor.relationship }}</td>
                      <td class="text-right">{{ formatPercent(inheritor.percentage) }}</td>
                      <td class="text-right">{{ inheritor.value | currency:'USD':'symbol':'1.0-0' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ scenario.clientOtherTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noClientOther>
    <h3 class="table-section-title other-title">Assets Passing to Other Joint Owners</h3>
    <p class="no-assets-message">No assets passing to other joint owners</p>
  </ng-template>

  <!-- ============================================================ -->
  <!-- SPOUSE SOLE (Unaffected) -->
  <!-- ============================================================ -->
  <ng-container *ngIf="scenario.spouseSole.length; else noSpouseSole">
    <h3 class="table-section-title spouse-sole-title">{{ spouseName }}'s Assets (Unaffected)</h3>
    <p class="section-note">Assets owned solely by {{ spouseName }} or {{ spouseName }}'s share of jointly-owned assets</p>
    <table class="scenario-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Status</th>
          <th class="text-center">Owner</th>
          <th class="text-right">Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of scenario.spouseSole">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ transferMechanismLabel(asset.transferMechanism) }}</td>
            <td class="text-center">
              <span class="inheritor-toggle" (click)="toggleAssetDetails(asset)">
                {{ asset.inheritors[0].name || spouseName }}
                <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.calculatedValue | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="isExpanded(asset)" class="detail-row">
            <td colspan="5">
              <div class="inheritor-details">
                <table class="inheritor-subtable">
                  <thead>
                    <tr>
                      <th>Owner</th>
                      <th>Relationship</th>
                      <th class="text-right">Share</th>
                      <th class="text-right">Value</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let inheritor of asset.inheritors">
                      <td>{{ inheritor.name }}</td>
                      <td>{{ inheritor.relationship }}</td>
                      <td class="text-right">{{ formatPercent(inheritor.percentage) }}</td>
                      <td class="text-right">{{ inheritor.value | currency:'USD':'symbol':'1.0-0' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ scenario.spouseSoleTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noSpouseSole>
    <h3 class="table-section-title spouse-sole-title">{{ spouseName }}'s Assets (Unaffected)</h3>
    <p class="no-assets-message">No assets solely owned by {{ spouseName }}</p>
  </ng-template>

  <!-- ============================================================ -->
  <!-- TRUST ASSETS -->
  <!-- ============================================================ -->
  <ng-container *ngIf="scenario.trustAssets.length; else noTrustAssets">
    <h3 class="table-section-title trust-title">Trust Assets</h3>
    <p class="section-note">Assets held in trust - distribution governed by trust terms</p>
    <table class="scenario-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Status</th>
          <th class="text-center">Beneficiaries</th>
          <th class="text-right">Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of scenario.trustAssets">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ transferMechanismLabel(asset.transferMechanism) }}</td>
            <td class="text-center">Per Trust Terms</td>
            <td class="text-right">{{ asset.calculatedValue | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ scenario.trustAssetsTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noTrustAssets>
    <h3 class="table-section-title trust-title">Trust Assets</h3>
    <p class="no-assets-message">No trust assets</p>
  </ng-template>

  <!-- ============================================================ -->
  <!-- LLC ASSETS -->
  <!-- ============================================================ -->
  <ng-container *ngIf="scenario.llcAssets.length; else noLLCAssets">
    <h3 class="table-section-title llc-title">LLC Assets</h3>
    <p class="section-note">Assets held in LLC - distribution governed by operating agreement</p>
    <table class="scenario-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Status</th>
          <th class="text-center">Members</th>
          <th class="text-right">Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of scenario.llcAssets">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ transferMechanismLabel(asset.transferMechanism) }}</td>
            <td class="text-center">Per Operating Agreement</td>
            <td class="text-right">{{ asset.calculatedValue | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ scenario.llcAssetsTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noLLCAssets>
    <h3 class="table-section-title llc-title">LLC Assets</h3>
    <p class="no-assets-message">No LLC assets</p>
  </ng-template>

  <!-- ============================================================ -->
  <!-- GRAND TOTAL -->
  <!-- ============================================================ -->
  <div class="grand-total-section">
    <div class="grand-total-row">
      <span class="grand-total-label">Total Estate Value:</span>
      <span class="grand-total-value">{{ scenario.grandTotal | currency:'USD':'symbol':'1.0-0' }}</span>
    </div>
  </div>

</div>
