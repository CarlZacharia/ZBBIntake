<div class="planning-container">
  <h2>Planning Overview</h2>

  <!-- Scenario Toggle Button Group -->
  <div class="view-toggle-group">
    <button
      class="view-toggle-btn"
      [class.active]="currentView === 'overview'"
      (click)="setView('overview')">
      Current Overview
    </button>
    <button
      class="view-toggle-btn"
      [class.active]="currentView === 'clientFirst'"
      (click)="setView('clientFirst')">
      {{ clientName }} Passes First
    </button>
    <button
      class="view-toggle-btn"
      [class.active]="currentView === 'spouseFirst'"
      (click)="setView('spouseFirst')"
      [disabled]="true">
      {{ spouseName }} Passes First
    </button>
    <button
      class="view-toggle-btn"
      [class.active]="currentView === 'bothDeceased'"
      (click)="setView('bothDeceased')"
      [disabled]="true">
      Both Deceased
    </button>
  </div>

  <!-- Client Passes First Scenario -->
  <ng-container *ngIf="currentView === 'clientFirst'">
    <app-planningc1
      [normalizedAssets]="normalized"
      [clientName]="clientName"
      [spouseName]="spouseName">
    </app-planningc1>
  </ng-container>

  <!-- Spouse Passes First Scenario (Coming Soon) -->
  <ng-container *ngIf="currentView === 'spouseFirst'">
    <div class="coming-soon">
      <h3>{{ spouseName }} Passes First Scenario</h3>
      <p>Coming soon...</p>
    </div>
  </ng-container>

  <!-- Both Deceased Scenario (Coming Soon) -->
  <ng-container *ngIf="currentView === 'bothDeceased'">
    <div class="coming-soon">
      <h3>Both Deceased Scenario</h3>
      <p>Coming soon...</p>
    </div>
  </ng-container>

  <!-- Current Overview (existing content) -->
  <ng-container *ngIf="currentView === 'overview'">

  <!-- Heirs Section -->
  <div class="heirs-section" style="display: flex; gap: 2em; align-items: flex-start;">
    <div class="heirs-column" style="flex: 1; margin-top: 1.5em;">
      <h3 style="font-size: 1.25em; font-weight: 700; color: #2b6cb0; margin-bottom: 0.75em; letter-spacing: 0.5px;">Client Heirs</h3>
      <ul style="list-style: none; padding: 0;">
        <li *ngFor="let heir of clientHeirs" style="display: flex; gap: 0.5em; align-items: center;">
          <span class="heir-type" style="display: inline-block; min-width: 110px; font-weight: 500;">{{ heir.type }}</span>
          <span style="display: inline-block; min-width: 140px;">{{ heir.name }}</span>
        </li>
      </ul>
    </div>
    <div class="heirs-column" style="flex: 1; margin-top: 1.5em;" *ngIf="spouseHeirs.length">
      <h3 style="font-size: 1.25em; font-weight: 700; color: #2b6cb0; margin-bottom: 0.75em; letter-spacing: 0.5px;">Spouse Heirs</h3>
      <ul style="list-style: none; padding: 0;">
        <li *ngFor="let heir of spouseHeirs" style="display: flex; gap: 0.5em; align-items: center;">
          <span class="heir-type" style="display: inline-block; min-width: 110px; font-weight: 500;">{{ heir.type }}</span>
          <span style="display: inline-block; min-width: 140px;">{{ heir.name }}</span>
        </li>
      </ul>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- CLIENT ASSETS SECTION -->
  <!-- ============================================================ -->
  <div class="section-divider"></div>
  <h2 class="table-main-title">Client Assets</h2>

  <!-- Client Probate Assets -->
  <ng-container *ngIf="clientProbateAssets.length; else noClientProbate">
    <h3 class="table-section-title">Client Probate Assets</h3>
    <table class="planning-assets-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Ownership Form</th>
          <th class="text-center">Beneficiaries?</th>
          <th class="text-right">Approx. Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of clientProbateAssets">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ ownershipFormLabel(asset.ownershipForm) }}</td>
            <td class="text-center">
              <span *ngIf="asset.has_bene !== 'Yes'">{{ getBeneficiaryLabel(asset.has_bene) }}</span>
              <span *ngIf="asset.has_bene === 'Yes'" class="bene-toggle" (click)="toggleBeneficiaryDetails(asset)">
                Yes <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.approximate_value | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="asset.has_bene === 'Yes' && isExpanded(asset)" class="beneficiary-row">
            <td colspan="5">
              <div class="beneficiary-details">
                <div class="beneficiary-tables">
                  <div *ngIf="asset.primary_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Primary Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.primary_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div *ngIf="asset.contingent_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Contingent Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.contingent_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ clientProbateTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noClientProbate>
    <p class="no-assets-message">No client probate assets</p>
  </ng-template>

  <!-- Client Non-Probate Assets -->
  <ng-container *ngIf="clientNonProbateAssets.length; else noClientNonProbate">
    <h3 class="table-section-title">Client Non-Probate Assets</h3>
    <table class="planning-assets-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Ownership Form</th>
          <th class="text-center">Beneficiaries?</th>
          <th class="text-right">Approx. Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of clientNonProbateAssets">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ ownershipFormLabel(asset.ownershipForm) }}</td>
            <td class="text-center">
              <span *ngIf="asset.has_bene !== 'Yes'">{{ getBeneficiaryLabel(asset.has_bene) }}</span>
              <span *ngIf="asset.has_bene === 'Yes'" class="bene-toggle" (click)="toggleBeneficiaryDetails(asset)">
                Yes <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.approximate_value | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="asset.has_bene === 'Yes' && isExpanded(asset)" class="beneficiary-row">
            <td colspan="5">
              <div class="beneficiary-details">
                <div class="beneficiary-tables">
                  <div *ngIf="asset.primary_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Primary Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.primary_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div *ngIf="asset.contingent_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Contingent Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.contingent_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ clientNonProbateTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noClientNonProbate>
    <p class="no-assets-message">No client non-probate assets</p>
  </ng-template>

  <!-- Client Joint with Spouse -->
  <ng-container *ngIf="clientJointWithSpouseAssets.length; else noClientJointSpouse">
    <h3 class="table-section-title">Client Joint with Spouse</h3>
    <table class="planning-assets-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Ownership Form</th>
          <th class="text-center">Beneficiaries?</th>
          <th class="text-right">Approx. Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of clientJointWithSpouseAssets">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ ownershipFormLabel(asset.ownershipForm) }}</td>
            <td class="text-center">
              <span *ngIf="asset.has_bene !== 'Yes'">{{ getBeneficiaryLabel(asset.has_bene) }}</span>
              <span *ngIf="asset.has_bene === 'Yes'" class="bene-toggle" (click)="toggleBeneficiaryDetails(asset)">
                Yes <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.approximate_value | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="asset.has_bene === 'Yes' && isExpanded(asset)" class="beneficiary-row">
            <td colspan="5">
              <div class="beneficiary-details">
                <div class="beneficiary-tables">
                  <div *ngIf="asset.primary_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Primary Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.primary_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div *ngIf="asset.contingent_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Contingent Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.contingent_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ clientJointWithSpouseTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noClientJointSpouse>
    <p class="no-assets-message">No client joint with spouse assets</p>
  </ng-template>

  <!-- Client Joint with Spouse and Others -->
  <ng-container *ngIf="clientJointWithSpouseAndOthersAssets.length; else noClientJointSpouseOthers">
    <h3 class="table-section-title">Client Joint with Spouse and Others</h3>
    <table class="planning-assets-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Ownership Form</th>
          <th class="text-center">Beneficiaries?</th>
          <th class="text-right">Approx. Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of clientJointWithSpouseAndOthersAssets">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ ownershipFormLabel(asset.ownershipForm) }}</td>
            <td class="text-center">
              <span *ngIf="asset.has_bene !== 'Yes'">{{ getBeneficiaryLabel(asset.has_bene) }}</span>
              <span *ngIf="asset.has_bene === 'Yes'" class="bene-toggle" (click)="toggleBeneficiaryDetails(asset)">
                Yes <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.approximate_value | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="asset.has_bene === 'Yes' && isExpanded(asset)" class="beneficiary-row">
            <td colspan="5">
              <div class="beneficiary-details">
                <div class="beneficiary-tables">
                  <div *ngIf="asset.primary_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Primary Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.primary_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div *ngIf="asset.contingent_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Contingent Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.contingent_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ clientJointWithSpouseAndOthersTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noClientJointSpouseOthers>
    <p class="no-assets-message">No client joint with spouse and others assets</p>
  </ng-template>

  <!-- Client and Others -->
  <ng-container *ngIf="clientAndOthersAssets.length; else noClientOthers">
    <h3 class="table-section-title">Client and Others</h3>
    <table class="planning-assets-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Ownership Form</th>
          <th class="text-center">Beneficiaries?</th>
          <th class="text-right">Approx. Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of clientAndOthersAssets">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ ownershipFormLabel(asset.ownershipForm) }}</td>
            <td class="text-center">
              <span *ngIf="asset.has_bene !== 'Yes'">{{ getBeneficiaryLabel(asset.has_bene) }}</span>
              <span *ngIf="asset.has_bene === 'Yes'" class="bene-toggle" (click)="toggleBeneficiaryDetails(asset)">
                Yes <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.approximate_value | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="asset.has_bene === 'Yes' && isExpanded(asset)" class="beneficiary-row">
            <td colspan="5">
              <div class="beneficiary-details">
                <div class="beneficiary-tables">
                  <div *ngIf="asset.primary_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Primary Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.primary_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div *ngIf="asset.contingent_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Contingent Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.contingent_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ clientAndOthersTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noClientOthers>
    <p class="no-assets-message">No client and others assets</p>
  </ng-template>

  <!-- ============================================================ -->
  <!-- SPOUSE ASSETS SECTION -->
  <!-- ============================================================ -->
  <div class="section-divider"></div>
  <h2 class="table-main-title">Spouse Assets</h2>

  <!-- Spouse Probate Assets -->
  <ng-container *ngIf="spouseProbateAssets.length; else noSpouseProbate">
    <h3 class="table-section-title">Spouse Probate Assets</h3>
    <table class="planning-assets-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Ownership Form</th>
          <th class="text-center">Beneficiaries?</th>
          <th class="text-right">Approx. Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of spouseProbateAssets">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ ownershipFormLabel(asset.ownershipForm) }}</td>
            <td class="text-center">
              <span *ngIf="asset.has_bene !== 'Yes'">{{ getBeneficiaryLabel(asset.has_bene) }}</span>
              <span *ngIf="asset.has_bene === 'Yes'" class="bene-toggle" (click)="toggleBeneficiaryDetails(asset)">
                Yes <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.approximate_value | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="asset.has_bene === 'Yes' && isExpanded(asset)" class="beneficiary-row">
            <td colspan="5">
              <div class="beneficiary-details">
                <div class="beneficiary-tables">
                  <div *ngIf="asset.primary_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Primary Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.primary_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div *ngIf="asset.contingent_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Contingent Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.contingent_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ spouseProbateTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noSpouseProbate>
    <p class="no-assets-message">No spouse probate assets</p>
  </ng-template>

  <!-- Spouse Non-Probate Assets -->
  <ng-container *ngIf="spouseNonProbateAssets.length; else noSpouseNonProbate">
    <h3 class="table-section-title">Spouse Non-Probate Assets</h3>
    <table class="planning-assets-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Ownership Form</th>
          <th class="text-center">Beneficiaries?</th>
          <th class="text-right">Approx. Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of spouseNonProbateAssets">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ ownershipFormLabel(asset.ownershipForm) }}</td>
            <td class="text-center">
              <span *ngIf="asset.has_bene !== 'Yes'">{{ getBeneficiaryLabel(asset.has_bene) }}</span>
              <span *ngIf="asset.has_bene === 'Yes'" class="bene-toggle" (click)="toggleBeneficiaryDetails(asset)">
                Yes <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.approximate_value | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="asset.has_bene === 'Yes' && isExpanded(asset)" class="beneficiary-row">
            <td colspan="5">
              <div class="beneficiary-details">
                <div class="beneficiary-tables">
                  <div *ngIf="asset.primary_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Primary Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.primary_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div *ngIf="asset.contingent_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Contingent Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.contingent_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ spouseNonProbateTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noSpouseNonProbate>
    <p class="no-assets-message">No spouse non-probate assets</p>
  </ng-template>

  <!-- Spouse Joint with Client -->
  <ng-container *ngIf="spouseJointWithClientAssets.length; else noSpouseJointClient">
    <h3 class="table-section-title">Spouse Joint with Client</h3>
    <table class="planning-assets-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Ownership Form</th>
          <th class="text-center">Beneficiaries?</th>
          <th class="text-right">Approx. Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of spouseJointWithClientAssets">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ ownershipFormLabel(asset.ownershipForm) }}</td>
            <td class="text-center">
              <span *ngIf="asset.has_bene !== 'Yes'">{{ getBeneficiaryLabel(asset.has_bene) }}</span>
              <span *ngIf="asset.has_bene === 'Yes'" class="bene-toggle" (click)="toggleBeneficiaryDetails(asset)">
                Yes <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.approximate_value | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="asset.has_bene === 'Yes' && isExpanded(asset)" class="beneficiary-row">
            <td colspan="5">
              <div class="beneficiary-details">
                <div class="beneficiary-tables">
                  <div *ngIf="asset.primary_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Primary Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.primary_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div *ngIf="asset.contingent_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Contingent Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.contingent_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ clientJointWithSpouseTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noSpouseJointClient>
    <p class="no-assets-message">No spouse joint with client assets</p>
  </ng-template>

  <!-- Spouse Joint with Client and Others -->
  <ng-container *ngIf="spouseJointWithClientAndOthersAssets.length; else noSpouseJointClientOthers">
    <h3 class="table-section-title">Spouse Joint with Client and Others</h3>
    <table class="planning-assets-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Ownership Form</th>
          <th class="text-center">Beneficiaries?</th>
          <th class="text-right">Approx. Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of spouseJointWithClientAndOthersAssets">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ ownershipFormLabel(asset.ownershipForm) }}</td>
            <td class="text-center">
              <span *ngIf="asset.has_bene !== 'Yes'">{{ getBeneficiaryLabel(asset.has_bene) }}</span>
              <span *ngIf="asset.has_bene === 'Yes'" class="bene-toggle" (click)="toggleBeneficiaryDetails(asset)">
                Yes <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.approximate_value | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="asset.has_bene === 'Yes' && isExpanded(asset)" class="beneficiary-row">
            <td colspan="5">
              <div class="beneficiary-details">
                <div class="beneficiary-tables">
                  <div *ngIf="asset.primary_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Primary Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.primary_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div *ngIf="asset.contingent_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Contingent Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.contingent_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
          <td class="text-right"><strong>{{ clientJointWithSpouseAndOthersTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noSpouseJointClientOthers>
    <p class="no-assets-message">No spouse joint with client and others assets</p>
  </ng-template>

  <!-- ============================================================ -->
  <!-- TRUST ASSETS SECTION -->
  <!-- ============================================================ -->
  <div class="section-divider"></div>
  <h2 class="table-main-title">Trust Assets</h2>

  <ng-container *ngIf="trustAssets.length; else noTrustAssets">
    <table class="planning-assets-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Ownership Form</th>
          <th class="text-center">Beneficiaries?</th>
          <th class="text-right">Approx. Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of trustAssets">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ ownershipFormLabel(asset.ownershipForm) }}</td>
            <td class="text-center">
              <span *ngIf="asset.has_bene !== 'Yes'">{{ getBeneficiaryLabel(asset.has_bene) }}</span>
              <span *ngIf="asset.has_bene === 'Yes'" class="bene-toggle" (click)="toggleBeneficiaryDetails(asset)">
                Yes <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.approximate_value | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="asset.has_bene === 'Yes' && isExpanded(asset)" class="beneficiary-row">
            <td colspan="5">
              <div class="beneficiary-details">
                <div class="beneficiary-tables">
                  <div *ngIf="asset.primary_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Primary Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.primary_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div *ngIf="asset.contingent_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Contingent Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.contingent_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Total Trust Assets:</strong></td>
          <td class="text-right"><strong>{{ trustTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noTrustAssets>
    <p class="no-assets-message">No trust assets</p>
  </ng-template>

  <!-- ============================================================ -->
  <!-- LLC ASSETS SECTION -->
  <!-- ============================================================ -->
  <div class="section-divider"></div>
  <h2 class="table-main-title">LLC Assets</h2>

  <ng-container *ngIf="llcAssets.length; else noLLCAssets">
    <table class="planning-assets-table">
      <thead>
        <tr>
          <th>Asset Type</th>
          <th>Name</th>
          <th>Ownership Form</th>
          <th class="text-center">Beneficiaries?</th>
          <th class="text-right">Approx. Value</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let asset of llcAssets">
          <tr>
            <td>{{ categoryLabel(asset.category) }}</td>
            <td>{{ asset.name }}</td>
            <td>{{ ownershipFormLabel(asset.ownershipForm) }}</td>
            <td class="text-center">
              <span *ngIf="asset.has_bene !== 'Yes'">{{ getBeneficiaryLabel(asset.has_bene) }}</span>
              <span *ngIf="asset.has_bene === 'Yes'" class="bene-toggle" (click)="toggleBeneficiaryDetails(asset)">
                Yes <span class="toggle-icon">{{ isExpanded(asset) ? '▼' : '▶' }}</span>
              </span>
            </td>
            <td class="text-right">{{ asset.approximate_value | currency:'USD':'symbol':'1.0-0' }}</td>
          </tr>
          <tr *ngIf="asset.has_bene === 'Yes' && isExpanded(asset)" class="beneficiary-row">
            <td colspan="5">
              <div class="beneficiary-details">
                <div class="beneficiary-tables">
                  <div *ngIf="asset.primary_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Primary Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.primary_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div *ngIf="asset.contingent_beneficiaries?.length" class="beneficiary-table-wrapper">
                    <table class="beneficiary-subtable">
                      <thead>
                        <tr><th colspan="2">Contingent Beneficiaries</th></tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let bene of asset.contingent_beneficiaries">
                          <td>{{ bene.name }}</td>
                          <td class="text-right">{{ bene.percentage }}%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr class="subtotal-row">
          <td colspan="4" class="text-right"><strong>Total LLC Assets:</strong></td>
          <td class="text-right"><strong>{{ llcTotal | currency:'USD':'symbol':'1.0-0' }}</strong></td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noLLCAssets>
    <p class="no-assets-message">No LLC assets</p>
  </ng-template>

  </ng-container><!-- End of overview view -->

</div>
