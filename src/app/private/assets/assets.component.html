<div class="assets-container">
  <h2>Assets</h2>

  <!-- Add Asset Buttons -->
  <div class="add-buttons-row">
    <button class="btn btn-add" (click)="openAddModal('real_estate')">
      + Real Estate
    </button>
    <button class="btn btn-add" (click)="openAddModal('bank_account')">
      + Bank Account
    </button>
    <button class="btn btn-add" (click)="openAddModal('nq_account')">
      + NQ Account
    </button>
    <button class="btn btn-add" (click)="openAddModal('retirement_account')">
      + Retirement Account
    </button>
    <button class="btn btn-add" (click)="openAddModal('life_insurance')">
      + Life Insurance
    </button>
    <button class="btn btn-add" (click)="openAddModal('business_interest')">
      + Business Interest
    </button>
    <button class="btn btn-add" (click)="openAddModal('digital_asset')">
      + Digital Asset
    </button>
    <button class="btn btn-add" (click)="openAddModal('other_asset')">
      + Other Asset
    </button>
  </div>

  <!-- Single Person View -->
  <ng-container *ngIf="showTable === 'single'" class="single-view">
    <h3>All Assets</h3>

    <!-- Real Estate -->
    <div class="asset-category" *ngIf="getAllAssets('real_estate').length > 0">
      <h4>Real Estate</h4>
      <table class="assets-table">
        <thead>
          <tr>
            <th>Property</th>
            <th>Value</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let asset of getAllAssets('real_estate'); let i = index"
            (click)="openEditModal('real_estate', i)"
            class="clickable-row"
          >
            <td>{{ getAssetDisplayName("real_estate", asset) }}</td>
            <td>{{ formatCurrency(getAssetValue("real_estate", asset)) }}</td>
            <td class="actions" (click)="$event.stopPropagation()">
              <button
                class="btn-small btn-delete"
                (click)="deleteAsset('real_estate', i)"
              >
                Delete
              </button>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr class="subtotal-row">
            <td><strong>Real Estate Total</strong></td>
            <td>
              <strong>{{
                formatCurrency(getTotalValue("real_estate"))
              }}</strong>
            </td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Bank Accounts -->
    <div class="asset-category" *ngIf="getAllAssets('bank_account').length > 0">
      <h4>Bank Accounts</h4>
      <table class="assets-table">
        <thead>
          <tr>
            <th>Account</th>
            <th>Value</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let asset of getAllAssets('bank_account'); let i = index"
            (click)="openEditModal('bank_account', i)"
            class="clickable-row"
          >
              <td>{{ getAssetDisplayName("bank_account", asset) }}</td>
            <td>{{ formatCurrency(getAssetValue("bank_account", asset)) }}</td>
            <td class="actions" (click)="$event.stopPropagation()">
              <button
                class="btn-small btn-delete"
                (click)="deleteAsset('bank_account', i)"
              >
                Delete
              </button>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr class="subtotal-row">
            <td><strong>Bank Accounts Total</strong></td>
            <td>
              <strong>{{
                formatCurrency(getTotalValue("bank_account"))
              }}</strong>
            </td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- NQ Accounts -->
    <div class="asset-category" *ngIf="getAllAssets('nq_account').length > 0">
      <h4>NQ Accounts</h4>
      <table class="assets-table">
        <thead>
          <tr>
            <th>Account</th>
            <th>Value</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let asset of getAllAssets('nq_account'); let i = index"
            (click)="openEditModal('nq_account', i)"
            class="clickable-row"
          >
            <td>{{ getAssetDisplayName("nq_account", asset) }}</td>
            <td>{{ formatCurrency(getAssetValue("nq_account", asset)) }}</td>
            <td class="actions" (click)="$event.stopPropagation()">
              <button
                class="btn-small btn-delete"
                (click)="deleteAsset('nq_account', i)"
              >
                Delete
              </button>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr class="subtotal-row">
            <td><strong>NQ Accounts Total</strong></td>
            <td>
              <strong>{{ formatCurrency(getTotalValue("nq_account")) }}</strong>
            </td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Retirement Accounts -->
    <div
      class="asset-category"
      *ngIf="getAllAssets('retirement_account').length > 0"
    >
      <h4>Retirement Accounts</h4>
      <table class="assets-table">
        <thead>
          <tr>
            <th>Account</th>
            <th>Value</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="
              let asset of getAllAssets('retirement_account');
              let i = index
            "
            (click)="openEditModal('retirement_account', i)"
            class="clickable-row"
          >
            <td>{{ getAssetDisplayName("retirement_account", asset) }}</td>
            <td>
              {{ formatCurrency(getAssetValue("retirement_account", asset)) }}
            </td>
            <td class="actions" (click)="$event.stopPropagation()">
              <button
                class="btn-small btn-delete"
                (click)="deleteAsset('retirement_account', i)"
              >
                Delete
              </button>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr class="subtotal-row">
            <td><strong>Retirement Accounts Total</strong></td>
            <td>
              <strong>{{
                formatCurrency(getTotalValue("retirement_account"))
              }}</strong>
            </td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Life Insurance -->
    <div
      class="asset-category"
      *ngIf="getAllAssets('life_insurance').length > 0"
    >
      <h4>Life Insurance</h4>
      <table class="assets-table">
        <thead>
          <tr>
            <th>Policy</th>
            <th>Death Benefit</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let asset of getAllAssets('life_insurance'); let i = index"
            (click)="openEditModal('life_insurance', i)"
            class="clickable-row"
          >
            <td>{{ getAssetDisplayName("life_insurance", asset) }}</td>
            <td>
              {{ formatCurrency(getAssetValue("life_insurance", asset)) }}
            </td>
            <td class="actions" (click)="$event.stopPropagation()">
              <button
                class="btn-small btn-delete"
                (click)="deleteAsset('life_insurance', i)"
              >
                Delete
              </button>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr class="subtotal-row">
            <td><strong>Life Insurance Total</strong></td>
            <td>
              <strong>{{
                formatCurrency(getTotalValue("life_insurance"))
              }}</strong>
            </td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Business Interests -->
    <div
      class="asset-category"
      *ngIf="getAllAssets('business_interest').length > 0"
    >
      <h4>Business Interests</h4>
      <table class="assets-table">
        <thead>
          <tr>
            <th>Business</th>
            <th>Value</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="
              let asset of getAllAssets('business_interest');
              let i = index
            "
            (click)="openEditModal('business_interest', i)"
            class="clickable-row"
          >
            <td>{{ getAssetDisplayName("business_interest", asset) }}</td>
            <td>
              {{ formatCurrency(getAssetValue("business_interest", asset)) }}
            </td>
            <td class="actions" (click)="$event.stopPropagation()">
              <button
                class="btn-small btn-delete"
                (click)="deleteAsset('business_interest', i)"
              >
                Delete
              </button>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr class="subtotal-row">
            <td><strong>Business Interests Total</strong></td>
            <td>
              <strong>{{
                formatCurrency(getTotalValue("business_interest"))
              }}</strong>
            </td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Digital Assets -->
    <div
      class="asset-category"
      *ngIf="getAllAssets('digital_asset').length > 0"
    >
      <h4>Digital Assets</h4>
      <table class="assets-table">
        <thead>
          <tr>
            <th>Asset</th>
            <th>Value</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let asset of getAllAssets('digital_asset'); let i = index"
            (click)="openEditModal('digital_asset', i)"
            class="clickable-row"
          >
            <td>{{ getAssetDisplayName("digital_asset", asset) }}</td>
            <td>{{ formatCurrency(getAssetValue("digital_asset", asset)) }}</td>
            <td class="actions" (click)="$event.stopPropagation()">
              <button
                class="btn-small btn-delete"
                (click)="deleteAsset('digital_asset', i)"
              >
                Delete
              </button>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr class="subtotal-row">
            <td><strong>Digital Assets Total</strong></td>
            <td>
              <strong>{{
                formatCurrency(getTotalValue("digital_asset"))
              }}</strong>
            </td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Other Assets -->
    <div class="asset-category" *ngIf="getAllAssets('other_asset').length > 0">
      <h4>Other Assets</h4>
      <table class="assets-table">
        <thead>
          <tr>
            <th>Asset</th>
            <th>Value</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let asset of getAllAssets('other_asset'); let i = index"
            (click)="openEditModal('other_asset', i)"
            class="clickable-row"
          >
            <td>{{ getAssetDisplayName("other_asset", asset) }}</td>
            <td>{{ formatCurrency(getAssetValue("other_asset", asset)) }}</td>
            <td class="actions" (click)="$event.stopPropagation()">
              <button
                class="btn-small btn-delete"
                (click)="deleteAsset('other_asset', i)"
              >
                Delete
              </button>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr class="subtotal-row">
            <td><strong>Other Assets Total</strong></td>
            <td>
              <strong>{{
                formatCurrency(getTotalValue("other_asset"))
              }}</strong>
            </td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Grand Total -->
    <div class="grand-total">
      <h3>Total Assets: {{ formatCurrency(getGrandTotal()) }}</h3>
    </div>
  </ng-container>

  <!-- Married Couple View -->
  <ng-container *ngIf="showTable === 'married'" class="married-view">
    <!-- Client Assets -->
    <div class="ownership-section">
      <h3>Client Assets</h3>

      <div
        class="asset-category"
        *ngIf="getClientAssets('real_estate').length > 0"
      >
        <h4>Real Estate</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Property</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getClientAssets('real_estate');
                let i = index
              "
              (click)="openEditModal('real_estate', i, 'Client')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("real_estate", asset) }}</td>
              <td>{{ formatCurrency(getAssetValue("real_estate", asset)) }}</td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('real_estate', i, 'Client')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getClientAssets('bank_account').length > 0"
      >
        <h4>Bank Accounts</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Account</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getClientAssets('bank_account');
                let i = index
              "
              (click)="openEditModal('bank_account', i, 'Client')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("bank_account", asset) }}</td>
              <td>
                {{ formatCurrency(getAssetValue("bank_account", asset)) }}
              </td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('bank_account', i, 'Client')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getClientAssets('nq_account').length > 0"
      >
        <h4>NQ Accounts</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Account</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let asset of getClientAssets('nq_account'); let i = index"
              (click)="openEditModal('nq_account', i, 'Client')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("nq_account", asset) }}</td>
              <td>{{ formatCurrency(getAssetValue("nq_account", asset)) }}</td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('nq_account', i, 'Client')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getClientAssets('retirement_account').length > 0"
      >
        <h4>Retirement Accounts</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Account</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getClientAssets('retirement_account');
                let i = index
              "
              (click)="openEditModal('retirement_account', i, 'Client')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("retirement_account", asset) }}</td>
              <td>
                {{ formatCurrency(getAssetValue("retirement_account", asset)) }}
              </td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('retirement_account', i, 'Client')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getClientAssets('life_insurance').length > 0"
      >
        <h4>Life Insurance</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Policy</th>
              <th>Death Benefit</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getClientAssets('life_insurance');
                let i = index
              "
              (click)="openEditModal('life_insurance', i, 'Client')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("life_insurance", asset) }}</td>
              <td>
                {{ formatCurrency(getAssetValue("life_insurance", asset)) }}
              </td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('life_insurance', i, 'Client')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getClientAssets('business_interest').length > 0"
      >
        <h4>Business Interests</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Business</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getClientAssets('business_interest');
                let i = index
              "
              (click)="openEditModal('business_interest', i, 'Client')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("business_interest", asset) }}</td>
              <td>
                {{ formatCurrency(getAssetValue("business_interest", asset)) }}
              </td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('business_interest', i, 'Client')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getClientAssets('digital_asset').length > 0"
      >
        <h4>Digital Assets</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Asset</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getClientAssets('digital_asset');
                let i = index
              "
              (click)="openEditModal('digital_asset', i, 'Client')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("digital_asset", asset) }}</td>
              <td>
                {{ formatCurrency(getAssetValue("digital_asset", asset)) }}
              </td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('digital_asset', i, 'Client')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getClientAssets('other_asset').length > 0"
      >
        <h4>Other Assets</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Asset</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getClientAssets('other_asset');
                let i = index
              "
              (click)="openEditModal('other_asset', i, 'Client')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("other_asset", asset) }}</td>
              <td>{{ formatCurrency(getAssetValue("other_asset", asset)) }}</td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('other_asset', i, 'Client')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="section-total">
        <strong
          >Client Total: {{ formatCurrency(getGrandTotal("Client")) }}</strong
        >
      </div>
    </div>

    <!-- Spouse Assets -->
    <div class="ownership-section">
      <h3>Spouse Assets</h3>

      <div
        class="asset-category"
        *ngIf="getSpouseAssets('real_estate').length > 0"
      >
        <h4>Real Estate</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Property</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getSpouseAssets('real_estate');
                let i = index
              "
              (click)="openEditModal('real_estate', i, 'Spouse')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("real_estate", asset) }}</td>
              <td>{{ formatCurrency(getAssetValue("real_estate", asset)) }}</td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('real_estate', i, 'Spouse')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getSpouseAssets('bank_account').length > 0"
      >
        <h4>Bank Accounts</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Account</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getSpouseAssets('bank_account');
                let i = index
              "
              (click)="openEditModal('bank_account', i, 'Spouse')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("bank_account", asset) }}</td>
              <td>
                {{ formatCurrency(getAssetValue("bank_account", asset)) }}
              </td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('bank_account', i, 'Spouse')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getSpouseAssets('nq_account').length > 0"
      >
        <h4>NQ Accounts</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Account</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let asset of getSpouseAssets('nq_account'); let i = index"
              (click)="openEditModal('nq_account', i, 'Spouse')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("nq_account", asset) }}</td>
              <td>{{ formatCurrency(getAssetValue("nq_account", asset)) }}</td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('nq_account', i, 'Spouse')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getSpouseAssets('retirement_account').length > 0"
      >
        <h4>Retirement Accounts</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Account</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getSpouseAssets('retirement_account');
                let i = index
              "
              (click)="openEditModal('retirement_account', i, 'Spouse')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("retirement_account", asset) }}</td>
              <td>
                {{ formatCurrency(getAssetValue("retirement_account", asset)) }}
              </td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('retirement_account', i, 'Spouse')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getSpouseAssets('life_insurance').length > 0"
      >
        <h4>Life Insurance</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Policy</th>
              <th>Death Benefit</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getSpouseAssets('life_insurance');
                let i = index
              "
              (click)="openEditModal('life_insurance', i, 'Spouse')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("life_insurance", asset) }}</td>
              <td>
                {{ formatCurrency(getAssetValue("life_insurance", asset)) }}
              </td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('life_insurance', i, 'Spouse')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getSpouseAssets('business_interest').length > 0"
      >
        <h4>Business Interests</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Business</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getSpouseAssets('business_interest');
                let i = index
              "
              (click)="openEditModal('business_interest', i, 'Spouse')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("business_interest", asset) }}</td>
              <td>
                {{ formatCurrency(getAssetValue("business_interest", asset)) }}
              </td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('business_interest', i, 'Spouse')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getSpouseAssets('digital_asset').length > 0"
      >
        <h4>Digital Assets</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Asset</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getSpouseAssets('digital_asset');
                let i = index
              "
              (click)="openEditModal('digital_asset', i, 'Spouse')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("digital_asset", asset) }}</td>
              <td>
                {{ formatCurrency(getAssetValue("digital_asset", asset)) }}
              </td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('digital_asset', i, 'Spouse')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getSpouseAssets('other_asset').length > 0"
      >
        <h4>Other Assets</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Asset</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getSpouseAssets('other_asset');
                let i = index
              "
              (click)="openEditModal('other_asset', i, 'Spouse')"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("other_asset", asset) }}</td>
              <td>{{ formatCurrency(getAssetValue("other_asset", asset)) }}</td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('other_asset', i, 'Spouse')"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="section-total">
        <strong
          >Spouse Total: {{ formatCurrency(getGrandTotal("Spouse")) }}</strong
        >
      </div>
    </div>

    <!-- Joint Assets -->
    <div class="ownership-section">
      <h3>Joint Assets</h3>

      <div
        class="asset-category"
        *ngIf="getJointAssets('real_estate').length > 0"
      >
        <h4>Real Estate</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Property</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let asset of getJointAssets('real_estate'); let i = index"
              (click)="openEditModal('real_estate', i, null)"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("real_estate", asset) }}</td>
              <td>{{ formatCurrency(getAssetValue("real_estate", asset)) }}</td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('real_estate', i, null)"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getJointAssets('bank_account').length > 0"
      >
        <h4>Bank Accounts</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Account</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getJointAssets('bank_account');
                let i = index
              "
              (click)="openEditModal('bank_account', i, null)"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("bank_account", asset) }}</td>
              <td>
                {{ formatCurrency(getAssetValue("bank_account", asset)) }}
              </td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('bank_account', i, null)"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getJointAssets('nq_account').length > 0"
      >
        <h4>NQ Accounts</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Account</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let asset of getJointAssets('nq_account'); let i = index"
              (click)="openEditModal('nq_account', i, null)"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("nq_account", asset) }}</td>
              <td>{{ formatCurrency(getAssetValue("nq_account", asset)) }}</td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('nq_account', i, null)"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getJointAssets('retirement_account').length > 0"
      >
        <h4>Retirement Accounts</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Account</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getJointAssets('retirement_account');
                let i = index
              "
              (click)="openEditModal('retirement_account', i, null)"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("retirement_account", asset) }}</td>
              <td>
                {{ formatCurrency(getAssetValue("retirement_account", asset)) }}
              </td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('retirement_account', i, null)"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getJointAssets('life_insurance').length > 0"
      >
        <h4>Life Insurance</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Policy</th>
              <th>Death Benefit</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getJointAssets('life_insurance');
                let i = index
              "
              (click)="openEditModal('life_insurance', i, null)"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("life_insurance", asset) }}</td>
              <td>
                {{ formatCurrency(getAssetValue("life_insurance", asset)) }}
              </td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('life_insurance', i, null)"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getJointAssets('business_interest').length > 0"
      >
        <h4>Business Interests</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Business</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getJointAssets('business_interest');
                let i = index
              "
              (click)="openEditModal('business_interest', i, null)"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("business_interest", asset) }}</td>
              <td>
                {{ formatCurrency(getAssetValue("business_interest", asset)) }}
              </td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('business_interest', i, null)"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getJointAssets('digital_asset').length > 0"
      >
        <h4>Digital Assets</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Asset</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let asset of getJointAssets('digital_asset');
                let i = index
              "
              (click)="openEditModal('digital_asset', i, null)"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("digital_asset", asset) }}</td>
              <td>
                {{ formatCurrency(getAssetValue("digital_asset", asset)) }}
              </td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('digital_asset', i, null)"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="asset-category"
        *ngIf="getJointAssets('other_asset').length > 0"
      >
        <h4>Other Assets</h4>
        <table class="assets-table">
          <thead>
            <tr>
              <th>Asset</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let asset of getJointAssets('other_asset'); let i = index"
              (click)="openEditModal('other_asset', i, null)"
              class="clickable-row"
            >
              <td>{{ getAssetDisplayName("other_asset", asset) }}</td>
              <td>{{ formatCurrency(getAssetValue("other_asset", asset)) }}</td>
              <td class="actions" (click)="$event.stopPropagation()">
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAsset('other_asset', i, null)"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="section-total">
        <strong>Joint Total: {{ formatCurrency(getGrandTotal(null)) }}</strong>
      </div>
    </div>

    <!-- Grand Total -->
    <div class="grand-total">
      <h3>
        Combined Total:
        {{
          formatCurrency(
            getGrandTotal("Client") +
              getGrandTotal("Spouse") +
              getGrandTotal(null)
          )
        }}
      </h3>
    </div>
  </ng-container>

  <ng-container *ngIf="showTable === 'default'">
    <div class="all-assets-debts-table-wrapper">
      <table class="all-assets-debts-table">
        <thead>
          <tr>
            <th
              colspan="6"
              style="
                font-size: 1rem;
                text-align: left;
                background: #00008B;
                color: white;
              "
            >
              Assets & Debts Overview
            </th>
          </tr>
        </thead>
        <tbody>
          <!-- Real Estate Holdings -->
          <tr *ngIf="assetsGroups.real_estate_holdings.length > 0">
            <td colspan="6" class="group-header">Real Estate Holdings</td>
          </tr>
          <tr
            class="sub-header"
            *ngIf="assetsGroups.real_estate_holdings.length > 0"
          >
            <td style="font-weight: bold; text-decoration: underline">
              Address
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              City, State, Zip
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Property Type
            </td>
            <td style="font-weight: bold; text-decoration: underline">Title</td>
            <td style="font-weight: bold; text-decoration: underline">
              Approx. Value
            </td>
          </tr>
          <tr
            *ngFor="
              let item of assetsGroups.real_estate_holdings;
              let i = index
            "
            (click)="openEditModal('real_estate', i)"
            class="clickable-row"
          >
            <td>{{ item.address_line1 }}</td>
            <td>{{ item.city }}, {{ item.state }}, {{ item.zip }}</td>
            <td>{{ item.property_type }}</td>
            <td>{{ item.owned_by }}</td>
            <td>{{ item.approximate_value | currency }}</td>
          </tr>
          <!-- Bank Account Holdings -->
          <tr *ngIf="assetsGroups.bank_account_holdings.length > 0">
            <td colspan="6" class="group-header">Bank Account Holdings</td>
          </tr>
          <tr
            class="sub-header"
            *ngIf="assetsGroups.bank_account_holdings.length > 0"
          >
            <td style="font-weight: bold; text-decoration: underline">
              Institution
            </td>
            <td style="font-weight: bold; text-decoration: underline">Type</td>
            <td style="font-weight: bold; text-decoration: underline">
              Account #
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Owned By
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Approx. Value
            </td>
          </tr>
          <tr
            *ngFor="
              let item of assetsGroups.bank_account_holdings;
              let i = index
            "
            (click)="openEditModal('bank_account', i)"
            class="clickable-row"
          >
            <td>{{ item.institution_name }}</td>
            <td>{{ item.account_type }}</td>
            <td>{{ item.account_number_encrypted }}</td>
            <td>{{ item.owned_by }}</td>
            <td>{{ item.approximate_value | currency }}</td>
          </tr>
          <!-- NQ Account Holdings -->
          <tr *ngIf="assetsGroups.nq_account_holdings.length > 0">
            <td colspan="6" class="group-header">NQ Account Holdings</td>
          </tr>
          <tr
            class="sub-header"
            *ngIf="assetsGroups.nq_account_holdings.length > 0"
          >
            <td style="font-weight: bold; text-decoration: underline">
              Institution
            </td>
            <td style="font-weight: bold; text-decoration: underline">Type</td>
            <td style="font-weight: bold; text-decoration: underline">
              Account #
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Owned By
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Approx. Value
            </td>
          </tr>
          <tr
            *ngFor="let item of assetsGroups.nq_account_holdings; let i = index"
            (click)="openEditModal('nq_account', i)"
            class="clickable-row"
          >
            <td>{{ item.institution_name }}</td>
            <td>{{ item.account_type }}</td>
            <td>{{ item.account_number_encrypted }}</td>
            <td>{{ item.owned_by }}</td>
            <td>{{ item.approximate_value | currency }}</td>
          </tr>
          <!-- Retirement Account Holdings -->
          <tr *ngIf="assetsGroups.retirement_account_holdings.length > 0">
            <td colspan="6" class="group-header">
              Retirement Account Holdings
            </td>
          </tr>
          <tr
            class="sub-header"
            *ngIf="assetsGroups.retirement_account_holdings.length > 0"
          >
            <td style="font-weight: bold; text-decoration: underline">
              Institution
            </td>
            <td style="font-weight: bold; text-decoration: underline">Type</td>
            <td style="font-weight: bold; text-decoration: underline">
              Account #
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Owned By
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Approx. Value
            </td>
          </tr>
          <tr
            *ngFor="
              let item of assetsGroups.retirement_account_holdings;
              let i = index
            "
            (click)="openEditModal('retirement_account', i)"
            class="clickable-row"
          >
            <td>{{ item.institution_name }}</td>
            <td>{{ item.account_type }}</td>
            <td>{{ item.account_number_encrypted }}</td>
            <td>{{ item.owned_by }}</td>
            <td>{{ item.approximate_value | currency }}</td>
          </tr>
          <!-- Life Insurance Holdings -->
          <tr *ngIf="assetsGroups.life_insurance_holdings.length > 0">
            <td colspan="6" class="group-header">Life Insurance Holdings</td>
          </tr>
          <tr
            class="sub-header"
            *ngIf="assetsGroups.life_insurance_holdings.length > 0"
          >
            <td style="font-weight: bold; text-decoration: underline">
              Company
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Policy Type
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Policy #
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Owned By
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Approx. Value
            </td>
          </tr>
          <tr
            *ngFor="
              let item of assetsGroups.life_insurance_holdings;
              let i = index
            "
            (click)="openEditModal('life_insurance', i, 'Client')"
            class="clickable-row"
          >
            <td>{{ item.insurance_company }}</td>
            <td>{{ item.policy_type }}</td>
            <td>{{ item.policy_number }}</td>
            <td>{{ item.owned_by }}</td>
            <td>{{ item.approximate_value | currency }}</td>
          </tr>
          <!-- Business Interest Holdings -->
          <tr *ngIf="assetsGroups.business_interest_holdings.length > 0">
            <td colspan="6" class="group-header">Business Interest Holdings</td>
          </tr>
          <tr
            class="sub-header"
            *ngIf="assetsGroups.business_interest_holdings.length > 0"
          >
            <td style="font-weight: bold; text-decoration: underline">
              Business Name
            </td>
            <td style="font-weight: bold; text-decoration: underline">Type</td>
            <td style="font-weight: bold; text-decoration: underline">
              Ownership %
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Owned By
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Approx. Value
            </td>
          </tr>
          <tr
            *ngFor="
              let item of assetsGroups.business_interest_holdings;
              let i = index
            "
            (click)="openEditModal('business_interest', i)"
            class="clickable-row"
          >
            <td>{{ item.business_name }}</td>
            <td>{{ item.business_type }}</td>
            <td>{{ item.ownership_percentage }}</td>
            <td>{{ item.owned_by }}</td>
            <td>{{ item.approximate_value | currency }}</td>
          </tr>
          <!-- Digital Asset Holdings -->
          <tr *ngIf="assetsGroups.digital_asset_holdings.length > 0">
            <td colspan="6" class="group-header">Digital Asset Holdings</td>
          </tr>
          <tr
            class="sub-header"
            *ngIf="assetsGroups.digital_asset_holdings.length > 0"
          >
            <td style="font-weight: bold; text-decoration: underline">
              Asset Name
            </td>
            <td style="font-weight: bold; text-decoration: underline">Type</td>
            <td style="font-weight: bold; text-decoration: underline">
              Access Location
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Owned By
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Approx. Value
            </td>
          </tr>
          <tr
            *ngFor="
              let item of assetsGroups.digital_asset_holdings;
              let i = index
            "
            (click)="openEditModal('digital_asset', i)"
            class="clickable-row"
          >
            <td>{{ item.asset_name }}</td>
            <td>{{ item.asset_type }}</td>
            <td>{{ item.access_location }}</td>
            <td>{{ item.owned_by }}</td>
            <td>{{ item.approximate_value | currency }}</td>
          </tr>
          <!-- Other Asset Holdings -->
          <tr *ngIf="assetsGroups.other_asset_holdings.length > 0">
            <td colspan="6" class="group-header">Other Asset Holdings</td>
          </tr>
          <tr
            class="sub-header"
            *ngIf="assetsGroups.other_asset_holdings.length > 0"
          >
            <td style="font-weight: bold; text-decoration: underline">
              Description
            </td>
            <td style="font-weight: bold; text-decoration: underline">Type</td>
            <td style="font-weight: bold; text-decoration: underline">
              Heirloom?
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Owned By
            </td>
            <td style="font-weight: bold; text-decoration: underline">
              Approx. Value
            </td>
          </tr>
          <tr
            *ngFor="
              let item of assetsGroups.other_asset_holdings;
              let i = index
            "
            (click)="openEditModal('other_asset', i)"
            class="clickable-row"
          >
            <td>{{ item.description }}</td>
            <td>{{ item.asset_type }}</td>
            <td>{{ item.is_heirloom ? "Yes" : "No" }}</td>
            <td>{{ item.owned_by }}</td>
            <td>{{ item.approximate_value | currency }}</td>
          </tr>
          <!-- Debt Holdings
        <tr *ngIf="debts.length > 0">
          <td colspan="6" class="group-header">Debt Holdings</td>
        </tr>
        <tr class="sub-header" *ngIf="debts.length > 0">
          <td>Creditor</td>
          <td>Type</td>
          <td>Account #</td>
          <td>Owned By</td>
          <td>Current Balance</td>
        </tr>
        <tr *ngFor="let item of debts; let i = index"
              (click)="openEditModal('debt', i, 'Client')" class="clickable-row">
          <td>{{item.creditor_name}}</td>
          <td>{{item.debt_type}}</td>
          <td>{{item.account_number}}</td>
          <td>{{item.owned_by}}</td>
          <td>{{item.current_balance | currency}}</td>
        </tr> -->
        </tbody>
      </table>
    </div>
  </ng-container>
</div>

<!-- Real Estate Add Modal -->
<div
  class="modal-overlay"
  *ngIf="showAddModal && currentAssetType === 'real_estate'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header add-modal-header">
      <h3>Add Real Estate</h3>
      <button class="close-btn" (click)="closeAddModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingRealEstate">
      <form #form="ngForm">
        <!-- Property Type -->
        <div class="form-group">
          <label>Property Type *</label>
          <select
            [(ngModel)]="editingRealEstate.property_type"
            name="property_type"
            required
          >
            <option value="Primary Residence">Primary Residence</option>
            <option value="Vacation">Vacation</option>
            <option value="Rental">Rental</option>
            <option value="Land">Land</option>
            <option value="Commercial">Commercial</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <!-- Address -->
        <div class="form-group">
          <label>Address Line 1 *</label>
          <input
            type="text"
            [(ngModel)]="editingRealEstate.address_line1"
            name="address1"
            required
          />
        </div>

        <div class="form-group">
          <label>Address Line 2</label>
          <input
            type="text"
            [(ngModel)]="editingRealEstate.address_line2"
            name="address2"
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>City *</label>
            <input
              type="text"
              [(ngModel)]="editingRealEstate.city"
              name="city"
              required
            />
          </div>
          <div class="form-group">
            <label>State *</label>
            <select [(ngModel)]="editingRealEstate.state" name="state" required>
              <option *ngFor="let state of states" [value]="state">
                {{ state }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label>ZIP *</label>
            <input
              type="text"
              [(ngModel)]="editingRealEstate.zip"
              name="zip"
              required
            />
          </div>
        </div>

        <!-- Ownership Structure -->
        <div class="form-row">
          <div class="form-group">
            <label>Owned By *</label>
            <select
              [(ngModel)]="editingRealEstate.owned_by"
              name="owned_by"
              required
            >
              <option value="Client">Client Only</option>
              <option value="Spouse" *ngIf="ds.isMarried()">Spouse Only</option>
              <option value="Client & Spouse" *ngIf="ds.isMarried()">
                Client & Spouse
              </option>
              <option value="Client & Other">Client & Other(s)</option>
              <option value="Spouse & Other" *ngIf="ds.isMarried()">
                Spouse & Other(s)
              </option>
              <option value="Client, Spouse & Other" *ngIf="ds.isMarried()">
                Client, Spouse & Other(s)
              </option>
              <option value="Trust">Trust</option>
              <option value="LLC">LLC</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="form-group">
            <label>Title Holding Method *</label>
            <select
              [(ngModel)]="editingRealEstate.ownership_form"
              name="ownership_form"
              required
            >
              @if (editingRealEstate.owned_by === 'Client' ||
              editingRealEstate.owned_by === 'Spouse' && ds.isMarried()) {
              <option value="Sole Ownership">
                Sole Ownership (Fee Simple)
              </option>
              } @if (editingRealEstate.owned_by !== 'Client' &&
              editingRealEstate.owned_by !== 'Spouse' &&
              editingRealEstate.owned_by !== 'Trust' &&
              editingRealEstate.owned_by !== 'LLC') {
              <option value="JTWROS">
                Joint Tenants with Rights of Survivorship
              </option>
              <option value="TIC">Tenants in Common</option>
              } @if (editingRealEstate.owned_by === 'Client & Spouse') {
              <option value="TBE">Tenants by the Entirety</option>
              } @if (editingRealEstate.owned_by === 'Client' ||
              editingRealEstate.owned_by === 'Client & Spouse' ||
              editingRealEstate.owned_by === 'Client & Other' ||
              editingRealEstate.owned_by === 'Client, Spouse & Other') {
              <option value="Life Estate - Client">
                Life Estate (Client as Life Tenant)
              </option>
              } @if (editingRealEstate.owned_by === 'Spouse' ||
              editingRealEstate.owned_by === 'Client & Spouse' ||
              editingRealEstate.owned_by === 'Spouse & Other' ||
              editingRealEstate.owned_by === 'Client, Spouse & Other') {
              <option value="Life Estate - Spouse">
                Life Estate (Spouse as Life Tenant)
              </option>
              } @if (editingRealEstate.owned_by !== 'Trust' &&
              editingRealEstate.owned_by !== 'LLC') {
              <option value="Life Estate">Life Estate</option>
              }@if (editingRealEstate.owned_by !== 'Trust' &&
              editingRealEstate.owned_by !== 'LLC') {
              <option value="Lady Bird Deed">
                Enhanced Life Estate (Lady Bird Deed)
              </option>
              } @if (editingRealEstate.owned_by === 'Trust') {
              <option value="In Trust">In Trust</option>
              } @if (editingRealEstate.owned_by === 'LLC') {
              <option value="LLC">LLC Interest</option>
              }
              <option value="Land Contract">
                Land Contract/Contract for Deed
              </option>
              <option value="Other">Other</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>Title Details</label>
          <textarea
            [(ngModel)]="editingRealEstate.title_details"
            name="title_details"
            rows="2"
          ></textarea>
        </div>

        <!-- Financial Details -->
        <div class="form-row">
          <div class="form-group">
            <label>Approximate Value</label>
            <input
              type="number"
              [(ngModel)]="editingRealEstate.approximate_value"
              name="approximate_value"
              required
            />
          </div>
          <div class="form-group">
            <label>Mortgage Balance</label>
            <input
              type="number"
              [(ngModel)]="editingRealEstate.mortgage_balance"
              name="mortgage_balance"
            />
          </div>
        </div>

        <!-- Tenants in Common Fields -->
        <div *ngIf="editingRealEstate.ownership_form === 'TIC'">
          <div class="form-row">
            <div class="form-group">
              <label>Ownership Percentage</label>
              <input
                type="number"
                [(ngModel)]="editingRealEstate.ownership_percentage"
                name="ownership_percentage"
                min="0"
                max="100"
              />
            </div>
          </div>

          <div class="form-group">
            <label>Other Owners</label>
            <textarea
              [(ngModel)]="editingRealEstate.other_owners"
              name="other_owners"
              rows="2"
              placeholder="List other owners and their percentages"
            ></textarea>
          </div>
        </div>

        @if (editingRealEstate.ownership_form === 'Lady Bird Deed' ||
        editingRealEstate.ownership_form === 'Life Estate') {
        <div class="form-group">
          <label>Beneficiaries on Deed</label>
          <textarea
            [(ngModel)]="editingRealEstate.beneficiaries_on_deed"
            name="beneficiaries_on_deed"
            rows="2"
          ></textarea>
        </div>
        }

        <div class="form-group">
          <label>Intended Beneficiary</label>
          <input
            type="text"
            [(ngModel)]="editingRealEstate.intended_beneficiary"
            name="intended_beneficiary"
          />
        </div>

        <!-- Special Notes -->
        <div class="form-group">
          <label>Special Notes & Comments</label>
          <textarea
            [(ngModel)]="editingRealEstate.special_notes"
            name="special_notes"
            rows="3"
          ></textarea>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeAddModal()">
            Cancel
          </button>
          <button
            class="btn btn-primary"
            [disabled]="!form.valid"
            (click)="saveNewAsset()"
          >
            Save
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Real Estate Edit Modal -->
<div
  class="modal-overlay"
  *ngIf="showEditModal && currentAssetType === 'real_estate'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header edit-modal-header">
      <h3>Edit Real Estate</h3>
      <button class="close-btn" (click)="closeEditModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingRealEstate">
      <form #form="ngForm">
        <!-- Property Type -->
        <div class="form-group">
          <label>Property Type *</label>
          <select
            [(ngModel)]="editingRealEstate.property_type"
            name="property_type"
            required
          >
            <option value="Primary Residence">Primary Residence</option>
            <option value="Vacation">Vacation</option>
            <option value="Rental">Rental</option>
            <option value="Land">Land</option>
            <option value="Commercial">Commercial</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <!-- Address -->
        <div class="form-group">
          <label>Address Line 1 *</label>
          <input
            type="text"
            [(ngModel)]="editingRealEstate.address_line1"
            name="address1"
            required
          />
        </div>

        <div class="form-group">
          <label>Address Line 2</label>
          <input
            type="text"
            [(ngModel)]="editingRealEstate.address_line2"
            name="address2"
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>City *</label>
            <input
              type="text"
              [(ngModel)]="editingRealEstate.city"
              name="city"
              required
            />
          </div>
          <div class="form-group">
            <label>State *</label>
            <select [(ngModel)]="editingRealEstate.state" name="state" required>
              <option *ngFor="let state of states" [value]="state">
                {{ state }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label>ZIP *</label>
            <input
              type="text"
              [(ngModel)]="editingRealEstate.zip"
              name="zip"
              required
            />
          </div>
        </div>

        <!-- Ownership Structure -->
        <div class="form-row">
          <div class="form-group" *ngIf="isMarried">
            <label>Owned By</label>
            <select
              [(ngModel)]="editingRealEstate.owned_by"
              name="owned_by"
              required
            >
              <option value="Client">Client Only</option>
              <option value="Spouse" *ngIf="ds.isMarried()">Spouse Only</option>
              <option value="Client & Spouse" *ngIf="ds.isMarried()">
                Client & Spouse
              </option>
              <option value="Client & Other">Client & Other(s)</option>
              <option value="Spouse & Other" *ngIf="ds.isMarried()">
                Spouse & Other(s)
              </option>
              <option value="Client, Spouse & Other" *ngIf="ds.isMarried()">
                Client, Spouse & Other(s)
              </option>
              <option value="Trust">Trust</option>
              <option value="LLC">LLC</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label>Title Holding Method *</label>
            <select
              [(ngModel)]="editingRealEstate.ownership_form"
              name="ownership_form"
              required
            >
              @if (editingRealEstate.owned_by === 'Client' ||
              editingRealEstate.owned_by === 'Spouse') {
              <option value="Sole Ownership">
                Sole Ownership (Fee Simple)
              </option>
              } @if (editingRealEstate.owned_by !== 'Client' &&
              editingRealEstate.owned_by !== 'Spouse' &&
              editingRealEstate.owned_by !== 'Trust' &&
              editingRealEstate.owned_by !== 'LLC') {
              <option value="JTWROS">
                Joint Tenants with Rights of Survivorship
              </option>
              <option value="TIC">Tenants in Common</option>
              } @if (editingRealEstate.owned_by === 'Client & Spouse') {
              <option value="TBE">Tenants by the Entirety</option>
              } @if (editingRealEstate.owned_by !== 'Trust' &&
              editingRealEstate.owned_by !== 'LLC') {
              <option value="Life Estate">Life Estate</option>
              }@if (editingRealEstate.owned_by !== 'Trust' &&
              editingRealEstate.owned_by !== 'LLC') {
              <option value="Lady Bird Deed">
                Enhanced Life Estate (Lady Bird Deed)
              </option>
              } @if (editingRealEstate.owned_by === 'Trust') {
              <option value="In Trust">In Trust</option>
              } @if (editingRealEstate.owned_by === 'LLC') {
              <option value="LLC">LLC Interest</option>
              }
              <option value="Land Contract">
                Land Contract/Contract for Deed
              </option>
              <option value="Other">Other</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>Title Details</label>
          <textarea
            [(ngModel)]="editingRealEstate.title_details"
            name="title_details"
            rows="2"
          ></textarea>
        </div>

        <!-- Financial Details -->
        <div class="form-row">
          <div class="form-group">
            <label>Approximate Value</label>
            <input
              type="number"
              [(ngModel)]="editingRealEstate.approximate_value"
              name="approximate_value"
              (ngModelChange)="onRealEstateValueChange()"
              required
            />
          </div>
          <div class="form-group">
            <label>Mortgage Balance</label>
            <input
              type="number"
              [(ngModel)]="editingRealEstate.mortgage_balance"
              name="mortgage_balance"
              (ngModelChange)="onRealEstateValueChange()"
            />
          </div>
        </div>

        <!-- Tenants in Common Fields -->
        <div *ngIf="editingRealEstate.ownership_form === 'TIC'">
          <div class="form-row">
            <div class="form-group">
              <label>Ownership Percentage</label>
              <input
                type="number"
                [(ngModel)]="editingRealEstate.ownership_percentage"
                name="ownership_percentage"
                min="0"
                max="100"
              />
            </div>
          </div>

          <div class="form-group">
            <label>Other Owners</label>
            <textarea
              [(ngModel)]="editingRealEstate.other_owners"
              name="other_owners"
              rows="2"
              placeholder="List other owners and their percentages"
            ></textarea>
          </div>
        </div>

        <!-- Beneficiary Information -->
        @if (editingRealEstate.ownership_form === 'Lady Bird Deed' ||
        editingRealEstate.ownership_form === 'Life Estate') {
        <div class="form-group">
          <label>Beneficiaries on Deed</label>
          <textarea
            [(ngModel)]="editingRealEstate.beneficiaries_on_deed"
            name="beneficiaries_on_deed"
            rows="2"
          ></textarea>
        </div>
        }
        <div class="form-group">
          <label>Intended Beneficiary</label>
          <input
            type="text"
            [(ngModel)]="editingRealEstate.intended_beneficiary"
            name="intended_beneficiary"
          />
        </div>

        <!-- Special Notes -->
        <div class="form-group">
          <label>Special Notes & Comments</label>
          <textarea
            [(ngModel)]="editingRealEstate.special_notes"
            name="special_notes"
            rows="3"
          ></textarea>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeEditModal()">
            Cancel
          </button>
          <button
            class="btn btn-primary"
            [disabled]="!form.valid"
            (click)="saveEditAsset()"
          >
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Bank Account Add Modal -->
<div
  class="modal-overlay"
  *ngIf="showAddModal && currentAssetType === 'bank_account'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header add-modal-header">
      <h3>Add Bank Account</h3>
      <button class="close-btn" (click)="closeAddModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingBankAccount">
      <form #form="ngForm">
        <!-- Institution Name -->
        <div class="form-group">
          <label>Institution Name *</label>
          <input
            type="text"
            [(ngModel)]="editingBankAccount.institution_name"
            name="institution_name"
            required
          />
        </div>

        <!-- Account Type -->
        <div class="form-row">
          <div class="form-group">
            <label>Account Type *</label>
            <select
              [(ngModel)]="editingBankAccount.account_type"
              name="account_type"
              required
            >
              <option value="Checking">Checking</option>
              <option value="Savings">Savings</option>
              <option value="Money Market">Money Market</option>
              <option value="Cert Deposit">Cert Deposit</option>
              <option value="Xmas Club">Xmas Club</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="form-group">
            <label>Account Number (last 4 digits)</label>
            <input
              type="text"
              [(ngModel)]="editingBankAccount.account_number_encrypted"
              name="account_number"
              maxlength="4"
            />
          </div>
        </div>

        <!-- Balance -->
        <div class="form-group">
          <label>Approximate Balance</label>
          <input
            type="number"
            [(ngModel)]="editingBankAccount.approximate_value"
            name="approximate_value"
            required
          />
        </div>

        <!-- Title Type -->
        <div class="form-row">
          <!-- Ownership (for married couples) -->
          <div class="form-group" *ngIf="isMarried">
            <label>Owned By</label>
            <select
              [(ngModel)]="editingBankAccount.owned_by"
              name="owned_by"
              required
            >
              <option value="Client">Client</option>
              <option value="Spouse" *ngIf="ds.isMarried()">Spouse</option>
              <option value="Client & Spouse" *ngIf="ds.isMarried()">
                Client & Spouse
              </option>
              <option value="Client & Other">Client & Other</option>
              <option value="Spouse & Other" *ngIf="ds.isMarried()">
                Spouse & Other
              </option>
              <option value="Client, Spouse & Other" *ngIf="ds.isMarried()">
                Client, Spouse & Other
              </option>
              <option value="Trust">Trust</option>
              <option value="LLC">LLC</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div
            class="form-group"
            *ngIf="
              editingBankAccount.owned_by === 'Client & Other' ||
              editingBankAccount.owned_by === 'Spouse & Other' ||
              editingBankAccount.owned_by === 'Client, Spouse & Other' ||
              editingBankAccount.owned_by === 'Other'
            "
          >
            <label>Joint Owner Name</label>
            <input
              type="text"
              [(ngModel)]="editingBankAccount.joint_owner_name"
              name="joint_owner_name"
            />
          </div>
        </div>

        <div class="form-group" *ngIf="isMarried">
          <label>Beneficiary Designation?</label>
          <div style="display: flex; align-items: center; gap: 1.5em;">
            <label style="display: flex; align-items: center; gap: 0.3em;">
              <input
                type="radio"
                [(ngModel)]="editingBankAccount.has_bene"
                name="has_bene"
                [value]="'Yes'"
                required
              />
              Yes
            </label>
            <label style="display: flex; align-items: center; gap: 0.3em;">
              <input
                type="radio"
                [(ngModel)]="editingBankAccount.has_bene"
                name="has_bene"
                [value]="'No'"
                required
              />
              No
            </label>
          </div>
        </div>

<!-- Beneficiary Designation Section -->
<div *ngIf="editingBankAccount.has_bene === 'Yes'" class="beneficiary-designation-section">
  <!-- Primary Beneficiaries Row -->
      <h4>Primary Beneficiaries</h4>
      <div class="distribution-type">
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="bankAccountPrimaryDistType" name="bankPrimaryDist" value="equal" (change)="recalculateBankAccountPrimary()"> Equal Amounts
        </label>
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="bankAccountPrimaryDistType" name="bankPrimaryDist" value="unequal"> Unequal Amounts
        </label>
      </div>
      <div class="beneficiary-selection">
        <!-- Available Heirs -->
        <div class="available-heirs">
          <h5>Available Heirs</h5>
          <div class="heir-list">
            <div *ngFor="let heir of getAvailablePrimaryHeirs('bank_account')"
                 class="heir-item clickable"
                 (click)="addBeneficiary('bank_account', 'primary', heir)">
              {{ heir.name }}
            </div>
            <div *ngIf="getAvailablePrimaryHeirs('bank_account').length === 0" class="no-heirs">
              No available heirs
            </div>
          </div>
        </div>
        <!-- Chosen Beneficiaries -->
        <div class="chosen-beneficiaries">
          <h5>Chosen</h5>
          <div class="beneficiary-list">
          <div *ngFor="let bene of getSafeBeneficiaryArray(editingBankAccount, 'primary_beneficiaries'); let i = index" class="beneficiary-item">
              <span class="bene-name">{{ bene.name }}</span>
              <input *ngIf="bankAccountPrimaryDistType === 'unequal'"
                     type="number"
                     [(ngModel)]="bene.percentage"
                     [name]="'bankPrimaryPct' + i"
                     min="0" max="100" step="0.01"
                     (ngModelChange)="recalculateBeneficiaryValue('bank_account', 'primary', i)"
                     class="percentage-input">
              <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
              <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
              <button type="button" class="btn-remove" (click)="removeBeneficiary('bank_account', 'primary', i)">&times;</button>
            </div>
            <div *ngIf="editingBankAccount.primary_beneficiaries && editingBankAccount.primary_beneficiaries.length === 0" class="no-beneficiaries">
              Click an heir to add
            </div>
          </div>
          <div class="total-row" *ngIf="editingBankAccount.primary_beneficiaries && editingBankAccount.primary_beneficiaries.length > 0">
            <strong>Total: {{ getPrimaryTotal('bank_account') | number:'1.2-2' }}%</strong>
          </div>
        </div>
      </div>
    </div>
  <!-- Secondary Beneficiaries Row -->
      <h4>Secondary Beneficiaries</h4>
      <div class="distribution-type">
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="bankAccountSecondaryDistType" name="bankSecondaryDist" value="equal" (change)="recalculateBankAccountSecondary()"> Equal Amounts
        </label>
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="bankAccountSecondaryDistType" name="bankSecondaryDist" value="unequal"> Unequal Amounts
        </label>
      </div>
      <div class="beneficiary-selection">
        <!-- Available Heirs -->
        <div class="available-heirs">
          <h5>Available Heirs</h5>
          <div class="heir-list">
            <div *ngFor="let heir of getAvailableSecondaryHeirs('bank_account')"
                 class="heir-item clickable"
                 (click)="addBeneficiary('bank_account', 'secondary', heir)">
              {{ heir.name }}
            </div>
            <div *ngIf="getAvailableSecondaryHeirs('bank_account').length === 0" class="no-heirs">
              No available heirs
            </div>
          </div>
        </div>
        <!-- Chosen Beneficiaries -->
        <div class="chosen-beneficiaries">
          <h5>Chosen</h5>
          <div class="beneficiary-list">
          <div *ngFor="let bene of getSafeBeneficiaryArray(editingBankAccount, 'contingent_beneficiaries'); let i = index" class="beneficiary-item">
              <span class="bene-name">{{ bene.name }}</span>
              <input *ngIf="bankAccountSecondaryDistType === 'unequal'"
                     type="number"
                     [(ngModel)]="bene.percentage"
                     [name]="'bankSecondaryPct' + i"
                     min="0" max="100" step="0.01"
                     (ngModelChange)="recalculateBeneficiaryValue('bank_account', 'secondary', i)"
                     class="percentage-input">
              <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
              <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
              <button type="button" class="btn-remove" (click)="removeBeneficiary('bank_account', 'secondary', i)">&times;</button>
            </div>
            <div *ngIf="editingBankAccount.contingent_beneficiaries && editingBankAccount.contingent_beneficiaries.length === 0" class="no-beneficiaries">
              Click an heir to add
            </div>
          </div>
          <div class="total-row" *ngIf="editingBankAccount.contingent_beneficiaries && editingBankAccount.contingent_beneficiaries.length > 0">
            <strong>Total: {{ getSecondaryTotal('bank_account') | number:'1.2-2' }}%</strong>
          </div>
        </div>
      </div>


        <!-- Notes -->
        <div class="form-group">
          <label>Notes</label>
          <textarea
            [(ngModel)]="editingBankAccount.notes"
            name="notes"
            rows="3"
          ></textarea>
        </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeAddModal()">
        Cancel
      </button>
      <button class="btn btn-primary" [disabled]="!form.valid" (click)="saveNewAsset()">Save</button>
    </div>
      </form>
    </div>
  </div>
</div>

<!-- Bank Account Edit Modal -->
<div
  class="modal-overlay"
  *ngIf="showEditModal && currentAssetType === 'bank_account'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header edit-modal-header">
      <h3>Edit Bank Account</h3>
      <button class="close-btn" (click)="closeEditModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingBankAccount">
      <form #form="ngForm">
        <!-- Institution Name -->
        <div class="form-group">
          <label>Institution Name *</label>
          <input
            type="text"
            [(ngModel)]="editingBankAccount.institution_name"
            name="institution_name"
            required
          />
        </div>

        <!-- Account Type -->
        <div class="form-row">
          <div class="form-group">
            <label>Account Type *</label>
            <select
              [(ngModel)]="editingBankAccount.account_type"
              name="account_type"
              required
            >
              <option value="Checking">Checking</option>
              <option value="Savings">Savings</option>
              <option value="Money Market">Money Market</option>
              <option value="CD">CD</option>
            </select>
          </div>

          <div class="form-group">
            <label>Account Number (last 4 digits)</label>
            <input
              type="text"
              [(ngModel)]="editingBankAccount.account_number_encrypted"
              name="account_number"
              maxlength="4"
            />
          </div>
        </div>

        <!-- Balance -->
        <div class="form-group">
          <label>Approximate Balance</label>
          <input
            type="number"
            [(ngModel)]="editingBankAccount.approximate_value"
            name="approximate_value"
            required
          />
        </div>

        <!-- Title Type -->
        <div class="form-row">
          <div class="form-group" *ngIf="isMarried">
            <label>Owned By</label>
            <select
              [(ngModel)]="editingBankAccount.owned_by"
              name="owned_by"
              required
            >
              <option value="Client">Client Only</option>
              <option value="Spouse">Spouse Only</option>
              <option value="Client & Spouse">Client & Spouse</option>
              <option value="Client & Other">Client & Other(s)</option>
              <option value="Spouse & Other">Spouse & Other(s)</option>
              <option value="Client, Spouse & Other">
                Client, Spouse & Other(s)
              </option>
              <option value="Trust">Trust</option>
              <option value="LLC">LLC</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div
            class="form-group"
            *ngIf="
              editingBankAccount.owned_by === 'Client & Other' ||
              editingBankAccount.owned_by === 'Spouse & Other' ||
              editingBankAccount.owned_by === 'Client, Spouse & Other' ||
              editingBankAccount.owned_by === 'Other'
            "
          >
            <label>Joint Owner Name</label>
            <input
              type="text"
              [(ngModel)]="editingBankAccount.joint_owner_name"
              name="joint_owner_name"
            />
          </div>
        </div>

        <div class="form-group" *ngIf="isMarried">
          <label>Beneficiary Designation?</label>
          <div style="display: flex; align-items: center; gap: 1.5em;">
            <label style="display: flex; align-items: center; gap: 0.3em;">
              <input type="radio" [(ngModel)]="editingBankAccount.has_bene" name="has_bene" [value]="'Yes'" required /> Yes
            </label>
            <label style="display: flex; align-items: center; gap: 0.3em;">
              <input type="radio" [(ngModel)]="editingBankAccount.has_bene" name="has_bene" [value]="'No'" required /> No
            </label>
          </div>
        </div>

<!-- Beneficiary Designation Section -->
<div *ngIf="editingBankAccount.has_bene === 'Yes'" class="beneficiary-designation-section">
  <!-- Primary Beneficiaries Row -->
  <h4>Primary Beneficiaries</h4>
  <div class="distribution-type">
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="bankAccountPrimaryDistType" name="bankPrimaryDist" value="equal" (change)="recalculateBankAccountPrimary()"> Equal Amounts
    </label>
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="bankAccountPrimaryDistType" name="bankPrimaryDist" value="unequal"> Unequal Amounts
    </label>
  </div>
  <div class="beneficiary-selection">
    <!-- Available Heirs -->
    <div class="available-heirs">
      <h5>Available Heirs</h5>
      <div class="heir-list">
        <div *ngFor="let heir of getAvailablePrimaryHeirs('bank_account')"
             class="heir-item clickable"
             (click)="addBeneficiary('bank_account', 'primary', heir)">
          {{ heir.name }}
        </div>
        <div *ngIf="getAvailablePrimaryHeirs('bank_account').length === 0" class="no-heirs">
          No available heirs
        </div>
      </div>
    </div>
    <!-- Chosen Beneficiaries -->
    <div class="chosen-beneficiaries">
      <h5>Chosen</h5>
      <div class="beneficiary-list">
          <div *ngFor="let bene of getSafeBeneficiaryArray(editingBankAccount, 'primary_beneficiaries'); let i = index" class="beneficiary-item">
          <span class="bene-name">{{ bene.name }}</span>
          <input *ngIf="bankAccountPrimaryDistType === 'unequal'"
                 type="number"
                 [(ngModel)]="bene.percentage"
                 [name]="'bankPrimaryPct' + i"
                 min="0" max="100" step="0.01"
                 (ngModelChange)="recalculateBeneficiaryValue('bank_account', 'primary', i)"
                 class="percentage-input">
          <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
          <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
          <button type="button" class="btn-remove" (click)="removeBeneficiary('bank_account', 'primary', i)">&times;</button>
        </div>
        <div *ngIf="editingBankAccount.primary_beneficiaries && editingBankAccount.primary_beneficiaries.length === 0" class="no-beneficiaries">
          Click an heir to add
        </div>
      </div>
      <div class="total-row" *ngIf="editingBankAccount.primary_beneficiaries && editingBankAccount.primary_beneficiaries.length > 0">
        <strong>Total: {{ getPrimaryTotal('bank_account') | number:'1.2-2' }}%</strong>
      </div>
    </div>
  </div>
  <!-- Secondary Beneficiaries Row -->
  <h4>Secondary Beneficiaries</h4>
  <div class="distribution-type">
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="bankAccountSecondaryDistType" name="bankSecondaryDist" value="equal" (change)="recalculateBankAccountSecondary()"> Equal Amounts
    </label>
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="bankAccountSecondaryDistType" name="bankSecondaryDist" value="unequal"> Unequal Amounts
    </label>
  </div>
  <div class="beneficiary-selection">
    <!-- Available Heirs -->
    <div class="available-heirs">
      <h5>Available Heirs</h5>
      <div class="heir-list">
        <div *ngFor="let heir of getAvailableSecondaryHeirs('bank_account')"
             class="heir-item clickable"
             (click)="addBeneficiary('bank_account', 'secondary', heir)">
          {{ heir.name }}
        </div>
        <div *ngIf="getAvailableSecondaryHeirs('bank_account').length === 0" class="no-heirs">
          No available heirs
        </div>
      </div>
    </div>
    <!-- Chosen Beneficiaries -->
    <div class="chosen-beneficiaries">
      <h5>Chosen</h5>
      <div class="beneficiary-list">
        <div *ngFor="let bene of getSafeBeneficiaryArray(editingBankAccount, 'contingent_beneficiaries'); let i = index" class="beneficiary-item">
          <span class="bene-name">{{ bene.name }}</span>
          <input *ngIf="bankAccountSecondaryDistType === 'unequal'"
                 type="number"
                 [(ngModel)]="bene.percentage"
                 [name]="'bankSecondaryPct' + i"
                 min="0" max="100" step="0.01"
                 (ngModelChange)="recalculateBeneficiaryValue('bank_account', 'secondary', i)"
                 class="percentage-input">
          <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
          <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
          <button type="button" class="btn-remove" (click)="removeBeneficiary('bank_account', 'secondary', i)">&times;</button>
        </div>
        <div *ngIf="editingBankAccount.contingent_beneficiaries && editingBankAccount.contingent_beneficiaries.length === 0" class="no-beneficiaries">
          Click an heir to add
        </div>
      </div>
      <div class="total-row" *ngIf="editingBankAccount.contingent_beneficiaries && editingBankAccount.contingent_beneficiaries.length > 0">
        <strong>Total: {{ getSecondaryTotal('bank_account') | number:'1.2-2' }}%</strong>
      </div>
    </div>
  </div>
</div>

        <!-- Notes -->
        <div class="form-group">
          <label>Notes</label>
          <textarea
            [(ngModel)]="editingBankAccount.notes"
            name="notes"
            rows="3"
          ></textarea>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeEditModal()">
            Cancel
          </button>
          <button class="btn btn-primary" [disabled]="!form.valid" (click)="saveEditAsset()">
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- NQ Account Add Modal -->
<div
  class="modal-overlay"
  *ngIf="showAddModal && currentAssetType === 'nq_account'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header add-modal-header">
      <h3>Add NQ Account</h3>
      <button class="close-btn" (click)="closeAddModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingNQAccount">
      <form #form="ngForm">
        <!-- Institution Name -->
        <div class="form-group">
          <label>Institution Name *</label>
          <input
            type="text"
            [(ngModel)]="editingNQAccount.institution_name"
            name="institution_name"
            required
          />
        </div>

        <!-- Account Type -->
        <div class="form-row">
          <div class="form-group">
            <label>Account Type *</label>
            <select
              [(ngModel)]="editingNQAccount.account_type"
              name="account_type"
              required
            >
              <option value="Brokerage">Brokerage</option>
              <option value="Other Investment">Other Investment</option>
            </select>
          </div>

          <div class="form-group">
            <label>Account Number (last 4 digits)</label>
            <input
              type="text"
              [(ngModel)]="editingNQAccount.account_number_encrypted"
              name="account_number"
              maxlength="4"
            />
          </div>
        </div>

        <!-- Balance -->
        <div class="form-group">
          <label>Approximate Balance</label>
          <input
            type="number"
            [(ngModel)]="editingNQAccount.approximate_value"
            name="approximate_value"
            required
          />
        </div>

        <!-- Ownership (for married couples) -->
        <div class="form-row">
          <div class="form-group" *ngIf="isMarried">
            <label>Owned By</label>
            <select
              [(ngModel)]="editingNQAccount.owned_by"
              name="owned_by"
              required
            >
              <option value="Client">Client</option>
              <option value="Spouse">Spouse</option>
              <option value="Client & Spouse">Client & Spouse</option>
              <option value="Client & Other">Client & Other</option>
              <option value="Spouse & Other">Spouse & Other</option>
              <option value="Client, Spouse & Other">
                Client, Spouse & Other
              </option>
              <option value="Trust">Trust</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <!-- Title Type -->
          <div
            class="form-group"
            *ngIf="
              editingNQAccount.owned_by === 'Client & Other' ||
              editingNQAccount.owned_by === 'Spouse & Other' ||
              editingNQAccount.owned_by === 'Client, Spouse & Other' ||
              editingNQAccount.owned_by === 'Other'
            "
          >
            <label>Joint Owner Name</label>
            <input
              type="text"
              [(ngModel)]="editingNQAccount.joint_owner_name"
              name="joint_owner_name"
            />
          </div>
        </div>

        <div class="form-group" *ngIf="isMarried">
          <label>Beneficiary Designation?</label>
          <div style="display: flex; align-items: center; gap: 1.5em;">
            <label style="display: flex; align-items: center; gap: 0.3em;">
              <input type="radio" [(ngModel)]="editingNQAccount.has_bene" name="has_bene" [value]="'Yes'" required /> Yes
            </label>
            <label style="display: flex; align-items: center; gap: 0.3em;">
              <input type="radio" [(ngModel)]="editingNQAccount.has_bene" name="has_bene" [value]="'No'" required /> No
            </label>
          </div>
        </div>
<!-- Beneficiary Designation Section -->
<div *ngIf="editingNQAccount.has_bene === 'Yes'" class="beneficiary-designation-section">
  <!-- Primary Beneficiaries Row -->
  <h4>Primary Beneficiaries</h4>
  <div class="distribution-type">
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="nqAccountPrimaryDistType" name="nqPrimaryDist" value="equal" (change)="recalculateNQAccountPrimary()"> Equal Amounts
    </label>
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="nqAccountPrimaryDistType" name="nqPrimaryDist" value="unequal"> Unequal Amounts
    </label>
  </div>
  <div class="beneficiary-selection">
    <div class="available-heirs">
      <h5>Available Heirs</h5>
      <div class="heir-list">
        <div *ngFor="let heir of getAvailablePrimaryHeirs('nq_account')"
             class="heir-item clickable"
             (click)="addBeneficiary('nq_account', 'primary', heir)">
          {{ heir.name }}
        </div>
        <div *ngIf="getAvailablePrimaryHeirs('nq_account').length === 0" class="no-heirs">No available heirs</div>
      </div>
    </div>
    <div class="chosen-beneficiaries">
      <h5>Chosen</h5>
      <div class="beneficiary-list">
      <div *ngFor="let bene of getSafeBeneficiaryArray(editingNQAccount, 'primary_beneficiaries'); let i = index" class="beneficiary-item">
          <span class="bene-name">{{ bene.name }}</span>
          <input *ngIf="nqAccountPrimaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'nqPrimaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('nq_account', 'primary', i)" class="percentage-input">
          <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
          <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
          <button type="button" class="btn-remove" (click)="removeBeneficiary('nq_account', 'primary', i)">&times;</button>
        </div>
        <div *ngIf="editingNQAccount.primary_beneficiaries && editingNQAccount.primary_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
      </div>
      <div class="total-row" *ngIf="editingNQAccount.primary_beneficiaries && editingNQAccount.primary_beneficiaries.length > 0">
        <strong>Total: {{ getPrimaryTotal('nq_account') | number:'1.2-2' }}%</strong>
      </div>
    </div>
  </div>
  <!-- Secondary Beneficiaries Row -->
  <h4>Secondary Beneficiaries</h4>
  <div class="distribution-type">
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="nqAccountSecondaryDistType" name="nqSecondaryDist" value="equal" (change)="recalculateNQAccountSecondary()"> Equal Amounts
    </label>
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="nqAccountSecondaryDistType" name="nqSecondaryDist" value="unequal"> Unequal Amounts
    </label>
  </div>
  <div class="beneficiary-selection">
    <div class="available-heirs">
      <h5>Available Heirs</h5>
      <div class="heir-list">
        <div *ngFor="let heir of getAvailableSecondaryHeirs('nq_account')" class="heir-item clickable" (click)="addBeneficiary('nq_account', 'secondary', heir)">
          {{ heir.name }}
        </div>
        <div *ngIf="getAvailableSecondaryHeirs('nq_account').length === 0" class="no-heirs">No available heirs</div>
      </div>
    </div>
    <div class="chosen-beneficiaries">
      <h5>Chosen</h5>
      <div class="beneficiary-list">
      <div *ngFor="let bene of getSafeBeneficiaryArray(editingNQAccount, 'contingent_beneficiaries'); let i = index" class="beneficiary-item">
          <span class="bene-name">{{ bene.name }}</span>
          <input *ngIf="nqAccountSecondaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'nqSecondaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('nq_account', 'secondary', i)" class="percentage-input">
          <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
          <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
          <button type="button" class="btn-remove" (click)="removeBeneficiary('nq_account', 'secondary', i)">&times;</button>
        </div>
        <div *ngIf="editingNQAccount.contingent_beneficiaries && editingNQAccount.contingent_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
      </div>
      <div class="total-row" *ngIf="editingNQAccount.contingent_beneficiaries && editingNQAccount.contingent_beneficiaries.length > 0">
        <strong>Total: {{ getSecondaryTotal('nq_account') | number:'1.2-2' }}%</strong>
      </div>
    </div>
  </div>
</div>

        <!-- Notes -->
        <div class="form-group">
          <label>Notes</label>
          <textarea
            [(ngModel)]="editingNQAccount.notes"
            name="notes"
            rows="3"
          ></textarea>
        </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeAddModal()">
        Cancel
      </button>
      <button class="btn btn-primary" [disabled]="!form.valid" (click)="saveNewAsset()">Save</button>
    </div>
      </form>
    </div>
  </div>
</div>

<!-- NQ Account Edit Modal -->
<div
  class="modal-overlay"
  *ngIf="showEditModal && currentAssetType === 'nq_account'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header edit-modal-header">
      <h3>Edit NQ Account</h3>
      <button class="close-btn" (click)="closeEditModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingNQAccount">
      <form #form="ngForm">
        <!-- Institution Name -->
        <div class="form-group">
          <label>Institution Name *</label>
          <input
            type="text"
            [(ngModel)]="editingNQAccount.institution_name"
            name="institution_name"
            required
          />
        </div>

        <!-- Account Type -->
        <div class="form-row">
          <div class="form-group">
            <label>Account Type *</label>
            <select
              [(ngModel)]="editingNQAccount.account_type"
              name="account_type"
              required
            >
              <option value="Brokerage">Brokerage</option>
              <option value="Other Investment">Other Investment</option>
            </select>
          </div>

          <div class="form-group">
            <label>Account Number (last 4 digits)</label>
            <input
              type="text"
              [(ngModel)]="editingNQAccount.account_number_encrypted"
              name="account_number"
              maxlength="4"
            />
          </div>
        </div>

        <!-- Balance -->
        <div class="form-group">
          <label>Approximate Balance</label>
          <input
            type="number"
            [(ngModel)]="editingNQAccount.approximate_value"
            name="approximate_value"
            required
          />
        </div>

        <!-- Title Type -->
        <div class="form-row">
          <div
            class="form-group"
            *ngIf="
              editingNQAccount.owned_by === 'Client & Other' ||
              editingNQAccount.owned_by === 'Spouse & Other' ||
              editingNQAccount.owned_by === 'Client, Spouse & Other' ||
              editingNQAccount.owned_by === 'Other'
            "
          >
            <label>Joint Owner Name</label>
            <input
              type="text"
              [(ngModel)]="editingNQAccount.joint_owner_name"
              name="joint_owner_name"
            />
          </div>
        </div>

        <!-- Ownership (for married couples) -->
        <div class="form-group" *ngIf="isMarried">
          <label>Owned By</label>
          <select
            [(ngModel)]="editingNQAccount.owned_by"
            name="owned_by"
            required
          >
            <option value="Client">Client</option>
            <option value="Spouse">Spouse</option>
            <option value="Client & Spouse">Client & Spouse</option>
            <option value="Client & Other">Client & Other</option>
            <option value="Spouse & Other">Spouse & Other</option>
            <option value="Client, Spouse & Other">
              Client, Spouse & Other
            </option>
            <option value="Trust">Trust</option>
            <option value="LLC">LLC</option>
            <option value="Other">Other</option>
          </select>
        </div>

<div class="form-group" *ngIf="isMarried">
  <label>Beneficiary Designation?</label>
  <div style="display: flex; align-items: center; gap: 1.5em;">
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="editingNQAccount.has_bene" name="has_bene" [value]="'Yes'" required /> Yes
    </label>
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="editingNQAccount.has_bene" name="has_bene" [value]="'No'" required /> No
    </label>
  </div>
</div>

<!-- Beneficiary Designation Section -->
<div *ngIf="editingNQAccount.has_bene === 'Yes'" class="beneficiary-designation-section">
  <!-- Primary Beneficiaries Row -->
  <h4>Primary Beneficiaries</h4>
  <div class="distribution-type">
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="nqAccountPrimaryDistType" name="nqPrimaryDist" value="equal" (change)="recalculateNQAccountPrimary()"> Equal Amounts
    </label>
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="nqAccountPrimaryDistType" name="nqPrimaryDist" value="unequal"> Unequal Amounts
    </label>
  </div>
  <div class="beneficiary-selection">
    <div class="available-heirs">
      <h5>Available Heirs</h5>
      <div class="heir-list">
        <div *ngFor="let heir of getAvailablePrimaryHeirs('nq_account')"
             class="heir-item clickable"
             (click)="addBeneficiary('nq_account', 'primary', heir)">
          {{ heir.name }}
        </div>
        <div *ngIf="getAvailablePrimaryHeirs('nq_account').length === 0" class="no-heirs">No available heirs</div>
      </div>
    </div>
    <div class="chosen-beneficiaries">
      <h5>Chosen</h5>
      <div class="beneficiary-list">
        <div *ngFor="let bene of getSafeBeneficiaryArray(editingNQAccount, 'primary_beneficiaries'); let i = index" class="beneficiary-item">
          <span class="bene-name">{{ bene.name }}</span>
          <input *ngIf="nqAccountPrimaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'nqPrimaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('nq_account', 'primary', i)" class="percentage-input">
          <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
          <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
          <button type="button" class="btn-remove" (click)="removeBeneficiary('nq_account', 'primary', i)">&times;</button>
        </div>
        <div *ngIf="editingNQAccount.primary_beneficiaries && editingNQAccount.primary_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
      </div>
      <div class="total-row" *ngIf="editingNQAccount.primary_beneficiaries && editingNQAccount.primary_beneficiaries.length > 0">
        <strong>Total: {{ getPrimaryTotal('nq_account') | number:'1.2-2' }}%</strong>
      </div>
    </div>
  </div>
  <!-- Secondary Beneficiaries Row -->
  <h4>Secondary Beneficiaries</h4>
  <div class="distribution-type">
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="nqAccountSecondaryDistType" name="nqSecondaryDist" value="equal" (change)="recalculateNQAccountSecondary()"> Equal Amounts
    </label>
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="nqAccountSecondaryDistType" name="nqSecondaryDist" value="unequal"> Unequal Amounts
    </label>
  </div>
  <div class="beneficiary-selection">
    <div class="available-heirs">
      <h5>Available Heirs</h5>
      <div class="heir-list">
        <div *ngFor="let heir of getAvailableSecondaryHeirs('nq_account')" class="heir-item clickable" (click)="addBeneficiary('nq_account', 'secondary', heir)">
          {{ heir.name }}
        </div>
        <div *ngIf="getAvailableSecondaryHeirs('nq_account').length === 0" class="no-heirs">No available heirs</div>
      </div>
    </div>
    <div class="chosen-beneficiaries">
      <h5>Chosen</h5>
      <div class="beneficiary-list">
        <div *ngFor="let bene of getSafeBeneficiaryArray(editingNQAccount, 'contingent_beneficiaries'); let i = index" class="beneficiary-item">
          <span class="bene-name">{{ bene.name }}</span>
          <input *ngIf="nqAccountSecondaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'nqSecondaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('nq_account', 'secondary', i)" class="percentage-input">
          <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
          <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
          <button type="button" class="btn-remove" (click)="removeBeneficiary('nq_account', 'secondary', i)">&times;</button>
        </div>
        <div *ngIf="editingNQAccount.contingent_beneficiaries && editingNQAccount.contingent_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
      </div>
      <div class="total-row" *ngIf="editingNQAccount.contingent_beneficiaries && editingNQAccount.contingent_beneficiaries.length > 0">
        <strong>Total: {{ getSecondaryTotal('nq_account') | number:'1.2-2' }}%</strong>
      </div>
    </div>
  </div>
</div>
        <!-- Notes -->
        <div class="form-group">
          <label>Notes</label>
          <textarea
            [(ngModel)]="editingNQAccount.notes"
            name="notes"
            rows="3"
          ></textarea>
        </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeEditModal()">
        Cancel
      </button>
      <button class="btn btn-primary" [disabled]="!form.valid" (click)="saveEditAsset()">
        Save Changes
      </button>
    </div>
      </form>
    </div>
  </div>
</div>

<!-- Retirement Account Add Modal -->
<div
  class="modal-overlay"
  *ngIf="showAddModal && currentAssetType === 'retirement_account'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header add-modal-header">
      <h3>Add Retirement Account</h3>
      <button class="close-btn" (click)="closeAddModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingRetirementAccount">
      <form #form="ngForm">
        <!-- Account Type -->
        <div class="form-group">
          <label>Account Type *</label>
          <select
            [(ngModel)]="editingRetirementAccount.account_type"
            name="account_type"
            required
          >
            <option value="401k">401(k)</option>
            <option value="403b">403(b)</option>
            <option value="Traditional IRA">Traditional IRA</option>
            <option value="Roth IRA">Roth IRA</option>
            <option value="SEP">SEP IRA</option>
            <option value="Simple IRA">SIMPLE IRA</option>
            <option value="Pension">Pension</option>
            <option value="Annuity">Annuity</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <!-- Institution Name -->
        <div class="form-group">
          <label>Institution Name *</label>
          <input
            type="text"
            [(ngModel)]="editingRetirementAccount.institution_name"
            name="institution_name"
            required
          />
        </div>

        <!-- Account Number -->
        <div class="form-group">
          <label>Account Number (last 4 digits)</label>
          <input
            type="text"
            [(ngModel)]="editingRetirementAccount.account_number_encrypted"
            name="account_number"
            maxlength="4"
          />
        </div>

        <!-- Balance -->
        <div class="form-group">
          <label>Approximate Value</label>
          <input
            type="number"
            [(ngModel)]="editingRetirementAccount.approximate_value"
            name="approximate_value"
            required
          />
        </div>

        <!-- Ownership (for married couples) -->
        <div class="form-group" *ngIf="isMarried">
          <label>Owned By</label>
          <select
            [(ngModel)]="editingRetirementAccount.owned_by"
            name="owned_by"
            required
          >
            <option value="Client">Client</option>
            <option value="Spouse">Spouse</option>
          </select>
        </div>

        <!-- RMD Information -->
        <div class="form-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="editingRetirementAccount.rmd_age_reached"
              name="rmd_age_reached"
            />
            RMD Age Reached
          </label>
        </div>

        <div class="form-group" *ngIf="isMarried">
          <label>Beneficiary Designation?</label>
          <div style="display: flex; align-items: center; gap: 1.5em;">
            <label style="display: flex; align-items: center; gap: 0.3em;">
              <input type="radio" [(ngModel)]="editingRetirementAccount.has_bene" name="has_bene" [value]="'Yes'" required /> Yes
            </label>
            <label style="display: flex; align-items: center; gap: 0.3em;">
              <input type="radio" [(ngModel)]="editingRetirementAccount.has_bene" name="has_bene" [value]="'No'" required /> No
            </label>
          </div>
        </div>

        <!-- Beneficiary Designation Section -->
<div *ngIf="editingRetirementAccount.has_bene === 'Yes'" class="beneficiary-designation-section">
  <!-- Primary Beneficiaries Row -->
  <h4>Primary Beneficiaries</h4>
  <div class="distribution-type">
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="retirementAccountPrimaryDistType" name="retirementPrimaryDist" value="equal" (change)="recalculateRetirementAccountPrimary()"> Equal Amounts
    </label>
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="retirementAccountPrimaryDistType" name="retirementPrimaryDist" value="unequal"> Unequal Amounts
    </label>
  </div>
  <div class="beneficiary-selection">
    <div class="available-heirs">
      <h5>Available Heirs</h5>
      <div class="heir-list">
        <div *ngFor="let heir of getAvailablePrimaryHeirs('retirement_account')" class="heir-item clickable" (click)="addBeneficiary('retirement_account', 'primary', heir)">{{ heir.name }}</div>
        <div *ngIf="getAvailablePrimaryHeirs('retirement_account').length === 0" class="no-heirs">No available heirs</div>
      </div>
    </div>
    <div class="chosen-beneficiaries">
      <h5>Chosen</h5>
      <div class="beneficiary-list">
        <div *ngFor="let bene of getSafeBeneficiaryArray(editingRetirementAccount, 'primary_beneficiaries'); let i = index" class="beneficiary-item">
          <span class="bene-name">{{ bene.name }}</span>
          <input *ngIf="retirementAccountPrimaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'retirementPrimaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('retirement_account', 'primary', i)" class="percentage-input">
          <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
          <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
          <button type="button" class="btn-remove" (click)="removeBeneficiary('retirement_account', 'primary', i)">&times;</button>
        </div>
        <div *ngIf="editingRetirementAccount.primary_beneficiaries && editingRetirementAccount.primary_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
      </div>
      <div class="total-row" *ngIf="editingRetirementAccount.primary_beneficiaries && editingRetirementAccount.primary_beneficiaries.length > 0"><strong>Total: {{ getPrimaryTotal('retirement_account') | number:'1.2-2' }}%</strong></div>
    </div>
  </div>
  <!-- Secondary Beneficiaries Row -->
  <h4>Secondary Beneficiaries</h4>
  <div class="distribution-type">
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="retirementAccountSecondaryDistType" name="retirementSecondaryDist" value="equal" (change)="recalculateRetirementAccountSecondary()"> Equal Amounts
    </label>
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="retirementAccountSecondaryDistType" name="retirementSecondaryDist" value="unequal"> Unequal Amounts
    </label>
  </div>
  <div class="beneficiary-selection">
    <div class="available-heirs">
      <h5>Available Heirs</h5>
      <div class="heir-list">
        <div *ngFor="let heir of getAvailableSecondaryHeirs('retirement_account')" class="heir-item clickable" (click)="addBeneficiary('retirement_account', 'secondary', heir)">{{ heir.name }}</div>
        <div *ngIf="getAvailableSecondaryHeirs('retirement_account').length === 0" class="no-heirs">No available heirs</div>
      </div>
    </div>
    <div class="chosen-beneficiaries">
      <h5>Chosen</h5>
      <div class="beneficiary-list">
        <div *ngFor="let bene of getSafeBeneficiaryArray(editingRetirementAccount, 'contingent_beneficiaries'); let i = index" class="beneficiary-item">
          <span class="bene-name">{{ bene.name }}</span>
          <input *ngIf="retirementAccountSecondaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'retirementSecondaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('retirement_account', 'secondary', i)" class="percentage-input">
          <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
          <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
          <button type="button" class="btn-remove" (click)="removeBeneficiary('retirement_account', 'secondary', i)">&times;</button>
        </div>
        <div *ngIf="editingRetirementAccount.contingent_beneficiaries && editingRetirementAccount.contingent_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
      </div>
      <div class="total-row" *ngIf="editingRetirementAccount.contingent_beneficiaries && editingRetirementAccount.contingent_beneficiaries.length > 0"><strong>Total: {{ getSecondaryTotal('retirement_account') | number:'1.2-2' }}%</strong></div>
    </div>
  </div>
</div>

        <!-- Notes -->
        <div class="form-group">
          <label>Notes</label>
          <textarea
            [(ngModel)]="editingRetirementAccount.notes"
            name="notes"
            rows="3"
          ></textarea>
        </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeAddModal()">
        Cancel
      </button>
      <button class="btn btn-primary" [disabled]="!form.valid" (click)="saveNewAsset()">Save</button>
    </div>
      </form>
    </div>
  </div>
</div>

<!-- Retirement Account Edit Modal -->
<div
  class="modal-overlay"
  *ngIf="showEditModal && currentAssetType === 'retirement_account'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header edit-modal-header">
      <h3>Edit Retirement Account</h3>
      <button class="close-btn" (click)="closeEditModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingRetirementAccount">
      <form #form="ngForm">
        <!-- Account Type -->
        <div class="form-group">
          <label>Account Type *</label>
          <select
            [(ngModel)]="editingRetirementAccount.account_type"
            name="account_type"
            required
          >
            <option value="401k">401(k)</option>
            <option value="403b">403(b)</option>
            <option value="Traditional IRA">Traditional IRA</option>
            <option value="Roth IRA">Roth IRA</option>
            <option value="SEP">SEP IRA</option>
            <option value="Simple IRA">SIMPLE IRA</option>
            <option value="Pension">Pension</option>
            <option value="Annuity">Annuity</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <!-- Institution Name -->
        <div class="form-group">
          <label>Institution Name *</label>
          <input
            type="text"
            [(ngModel)]="editingRetirementAccount.institution_name"
            name="institution_name"
            required
          />
        </div>

        <!-- Account Number -->
        <div class="form-group">
          <label>Account Number (last 4 digits)</label>
          <input
            type="text"
            [(ngModel)]="editingRetirementAccount.account_number_encrypted"
            name="account_number"
            maxlength="4"
          />
        </div>

        <!-- Balance -->
        <div class="form-group">
          <label>Approximate Value</label>
          <input
            type="number"
            [(ngModel)]="editingRetirementAccount.approximate_value"
            name="approximate_value"
            required
          />
        </div>

        <!-- Ownership (for married couples) -->
        <div class="form-group" *ngIf="isMarried">
          <label>Owned By</label>
          <select
            [(ngModel)]="editingRetirementAccount.owned_by"
            name="owned_by"
            required
          >
            <option value="Client">Client</option>
            <option value="Spouse">Spouse</option>
          </select>
        </div>

        <!-- RMD Information -->
        <div class="form-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="editingRetirementAccount.rmd_age_reached"
              name="rmd_age_reached"
            />
            RMD Age Reached
          </label>
        </div>

<div class="form-group" *ngIf="isMarried">
  <label>Beneficiary Designation?</label>
  <div style="display: flex; align-items: center; gap: 1.5em;">
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="editingRetirementAccount.has_bene" name="has_bene" [value]="'Yes'" required /> Yes
    </label>
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="editingRetirementAccount.has_bene" name="has_bene" [value]="'No'" required /> No
    </label>
  </div>
</div>

<!-- Beneficiary Designation Section -->
<div *ngIf="editingRetirementAccount.has_bene === 'Yes'" class="beneficiary-designation-section">
  <!-- Primary Beneficiaries Row -->
  <h4>Primary Beneficiaries</h4>
  <div class="distribution-type">
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="retirementAccountPrimaryDistType" name="retirementPrimaryDist" value="equal" (change)="recalculateRetirementAccountPrimary()"> Equal Amounts
    </label>
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="retirementAccountPrimaryDistType" name="retirementPrimaryDist" value="unequal"> Unequal Amounts
    </label>
  </div>
  <div class="beneficiary-selection">
    <div class="available-heirs">
      <h5>Available Heirs</h5>
      <div class="heir-list">
        <div *ngFor="let heir of getAvailablePrimaryHeirs('retirement_account')" class="heir-item clickable" (click)="addBeneficiary('retirement_account', 'primary', heir)">{{ heir.name }}</div>
        <div *ngIf="getAvailablePrimaryHeirs('retirement_account').length === 0" class="no-heirs">No available heirs</div>
      </div>
    </div>
    <div class="chosen-beneficiaries">
      <h5>Chosen</h5>
      <div class="beneficiary-list">
        <div *ngFor="let bene of getSafeBeneficiaryArray(editingRetirementAccount, 'primary_beneficiaries'); let i = index" class="beneficiary-item">
          <span class="bene-name">{{ bene.name }}</span>
          <input *ngIf="retirementAccountPrimaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'retirementPrimaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('retirement_account', 'primary', i)" class="percentage-input">
          <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
          <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
          <button type="button" class="btn-remove" (click)="removeBeneficiary('retirement_account', 'primary', i)">&times;</button>
        </div>
        <div *ngIf="editingRetirementAccount.primary_beneficiaries && editingRetirementAccount.primary_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
      </div>
      <div class="total-row" *ngIf="editingRetirementAccount.primary_beneficiaries && editingRetirementAccount.primary_beneficiaries.length > 0"><strong>Total: {{ getPrimaryTotal('retirement_account') | number:'1.2-2' }}%</strong></div>
    </div>
  </div>
  <!-- Secondary Beneficiaries Row -->
  <h4>Secondary Beneficiaries</h4>
  <div class="distribution-type">
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="retirementAccountSecondaryDistType" name="retirementSecondaryDist" value="equal" (change)="recalculateRetirementAccountSecondary()"> Equal Amounts
    </label>
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="retirementAccountSecondaryDistType" name="retirementSecondaryDist" value="unequal"> Unequal Amounts
    </label>
  </div>
  <div class="beneficiary-selection">
    <div class="available-heirs">
      <h5>Available Heirs</h5>
      <div class="heir-list">
        <div *ngFor="let heir of getAvailableSecondaryHeirs('retirement_account')" class="heir-item clickable" (click)="addBeneficiary('retirement_account', 'secondary', heir)">{{ heir.name }}</div>
        <div *ngIf="getAvailableSecondaryHeirs('retirement_account').length === 0" class="no-heirs">No available heirs</div>
      </div>
    </div>
    <div class="chosen-beneficiaries">
      <h5>Chosen</h5>
      <div class="beneficiary-list">
        <div *ngFor="let bene of getSafeBeneficiaryArray(editingRetirementAccount, 'contingent_beneficiaries'); let i = index" class="beneficiary-item">
          <span class="bene-name">{{ bene.name }}</span>
          <input *ngIf="retirementAccountSecondaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'retirementSecondaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('retirement_account', 'secondary', i)" class="percentage-input">
          <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
          <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
          <button type="button" class="btn-remove" (click)="removeBeneficiary('retirement_account', 'secondary', i)">&times;</button>
        </div>
        <div *ngIf="editingRetirementAccount.contingent_beneficiaries && editingRetirementAccount.contingent_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
      </div>
      <div class="total-row" *ngIf="editingRetirementAccount.contingent_beneficiaries && editingRetirementAccount.contingent_beneficiaries.length > 0"><strong>Total: {{ getSecondaryTotal('retirement_account') | number:'1.2-2' }}%</strong></div>
    </div>
  </div>
</div>

        <!-- Notes -->
        <div class="form-group">
          <label>Notes</label>
          <textarea
            [(ngModel)]="editingRetirementAccount.notes"
            name="notes"
            rows="3"
          ></textarea>
        </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeEditModal()">
        Cancel
      </button>
      <button class="btn btn-primary" (click)="saveEditAsset()">
        Save Changes
      </button>
    </div>
      </form>
    </div>
  </div>
</div>

<!-- Life Insurance Add Modal -->
<div
  class="modal-overlay"
  *ngIf="showAddModal && currentAssetType === 'life_insurance'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header add-modal-header">
      <h3>Add Life Insurance Policy</h3>
      <button class="close-btn" (click)="closeAddModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingLifeInsurance">
      <form #form="ngForm">
        <!-- Insurance Company -->
        <div class="form-group">
          <label>Insurance Company *</label>
          <input
            type="text"
            [(ngModel)]="editingLifeInsurance.insurance_company"
            name="insurance_company"
            required
          />
        </div>

        <!-- Policy Type -->
        <div class="form-row">
          <div class="form-group">
            <label>Policy Type *</label>
            <select
              [(ngModel)]="editingLifeInsurance.policy_type"
              name="policy_type"
              required
            >
              <option value="term">Term</option>
              <option value="whole_life">Whole Life</option>
              <option value="universal">Universal</option>
              <option value="variable">Variable</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="form-group">
            <label>Policy Number</label>
            <input
              type="text"
              [(ngModel)]="editingLifeInsurance.policy_number"
              name="policy_number"
            />
          </div>
        </div>

        <!-- Financial Details -->
        <div class="form-row">
          <div class="form-group">
            <label>Face Value *</label>
            <input
              type="number"
              [(ngModel)]="editingLifeInsurance.face_value"
              name="face_value"
              required
            />
          </div>
          <div class="form-group">
            <label>Death Benefit *</label>
            <input
              type="number"
              [(ngModel)]="editingLifeInsurance.approximate_value"
              name="approximate_value"
              required
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Cash Value</label>
            <input
              type="number"
              [(ngModel)]="editingLifeInsurance.cash_value"
              name="cash_value"
            />
          </div>
          <div class="form-group">
            <label>Annual Premium</label>
            <input
              type="number"
              [(ngModel)]="editingLifeInsurance.annual_premium"
              name="annual_premium"
            />
          </div>
        </div>

        <!-- Trust Ownership -->
        <div class="form-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="editingLifeInsurance.owned_by_trust"
              name="owned_by_trust"
            />
            Owned by Trust
          </label>
        </div>

        <div class="form-group" *ngIf="editingLifeInsurance.owned_by_trust">
          <label>Trust Name</label>
          <input
            type="text"
            [(ngModel)]="editingLifeInsurance.trust_name"
            name="trust_name"
          />
        </div>

        <!-- Ownership (for married couples) -->
        <div class="form-group" *ngIf="isMarried">
          <label>Owned By</label>
          <select
            [(ngModel)]="editingLifeInsurance.owned_by"
            name="owned_by"
            required
          >
            <option value="Joint">Joint</option>
            <option value="Client">Client</option>
            <option value="Spouse">Spouse</option>
          </select>
        </div>

        <div class="form-group" *ngIf="isMarried">
          <label>Beneficiary Designation?</label>
          <div style="display: flex; align-items: center; gap: 1.5em;">
            <label style="display: flex; align-items: center; gap: 0.3em;">
              <input type="radio" [(ngModel)]="editingLifeInsurance.has_bene" name="has_bene" [value]="'Yes'" required /> Yes
            </label>
            <label style="display: flex; align-items: center; gap: 0.3em;">
              <input type="radio" [(ngModel)]="editingLifeInsurance.has_bene" name="has_bene" [value]="'No'" required /> No
            </label>
          </div>
        </div>

<!-- Beneficiary Designation Section -->
<div *ngIf="editingLifeInsurance.has_bene === 'Yes'" class="beneficiary-designation-section">
  <div class="beneficiary-columns">
    <div class="beneficiary-column">
      <h4>Primary Beneficiaries</h4>
      <div class="distribution-type">
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="lifeInsurancePrimaryDistType" name="lifePrimaryDist" value="equal" (change)="recalculateLifeInsurancePrimary()"> Equal Amounts
        </label>
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="lifeInsurancePrimaryDistType" name="lifePrimaryDist" value="unequal"> Unequal Amounts
        </label>
      </div>
      <div class="beneficiary-selection">
        <div class="available-heirs">
          <h5>Available Heirs</h5>
          <div class="heir-list">
            <div *ngFor="let heir of getAvailablePrimaryHeirs('life_insurance')" class="heir-item clickable" (click)="addBeneficiary('life_insurance', 'primary', heir)">{{ heir.name }}</div>
            <div *ngIf="getAvailablePrimaryHeirs('life_insurance').length === 0" class="no-heirs">No available heirs</div>
          </div>
        </div>
        <div class="chosen-beneficiaries">
          <h5>Chosen</h5>
          <div class="beneficiary-list">
            <div *ngFor="let bene of getSafeBeneficiaryArray(editingLifeInsurance, 'primary_beneficiaries'); let i = index" class="beneficiary-item">
              <span class="bene-name">{{ bene.name }}</span>
              <input *ngIf="lifeInsurancePrimaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'lifePrimaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('life_insurance', 'primary', i)" class="percentage-input">
              <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
              <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
              <button type="button" class="btn-remove" (click)="removeBeneficiary('life_insurance', 'primary', i)">&times;</button>
            </div>
            <div *ngIf="editingLifeInsurance.primary_beneficiaries && editingLifeInsurance.primary_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
          </div>
          <div class="total-row" *ngIf="editingLifeInsurance.primary_beneficiaries && editingLifeInsurance.primary_beneficiaries.length > 0"><strong>Total: {{ getPrimaryTotal('life_insurance') | number:'1.2-2' }}%</strong></div>
        </div>
      </div>
    </div>
    <div class="beneficiary-column">
      <h4>Secondary Beneficiaries</h4>
      <div class="distribution-type">
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="lifeInsuranceSecondaryDistType" name="lifeSecondaryDist" value="equal" (change)="recalculateLifeInsuranceSecondary()"> Equal Amounts
        </label>
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="lifeInsuranceSecondaryDistType" name="lifeSecondaryDist" value="unequal"> Unequal Amounts
        </label>
      </div>
      <div class="beneficiary-selection">
        <div class="available-heirs">
          <h5>Available Heirs</h5>
          <div class="heir-list">
            <div *ngFor="let heir of getAvailableSecondaryHeirs('life_insurance')" class="heir-item clickable" (click)="addBeneficiary('life_insurance', 'secondary', heir)">{{ heir.name }}</div>
            <div *ngIf="getAvailableSecondaryHeirs('life_insurance').length === 0" class="no-heirs">No available heirs</div>
          </div>
        </div>
        <div class="chosen-beneficiaries">
          <h5>Chosen</h5>
          <div class="beneficiary-list">
            <div *ngFor="let bene of getSafeBeneficiaryArray(editingLifeInsurance, 'contingent_beneficiaries'); let i = index" class="beneficiary-item">
              <span class="bene-name">{{ bene.name }}</span>
              <input *ngIf="lifeInsuranceSecondaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'lifeSecondaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('life_insurance', 'secondary', i)" class="percentage-input">
              <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
              <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
              <button type="button" class="btn-remove" (click)="removeBeneficiary('life_insurance', 'secondary', i)">&times;</button>
            </div>
            <div *ngIf="editingLifeInsurance.contingent_beneficiaries && editingLifeInsurance.contingent_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
          </div>
          <div class="total-row" *ngIf="editingLifeInsurance.contingent_beneficiaries && editingLifeInsurance.contingent_beneficiaries.length > 0"><strong>Total: {{ getSecondaryTotal('life_insurance') | number:'1.2-2' }}%</strong></div>
        </div>
      </div>
    </div>
  </div>
</div>

        <!-- Notes -->
        <div class="form-group">
          <label>Notes</label>
          <textarea
            [(ngModel)]="editingLifeInsurance.notes"
            name="notes"
            rows="3"
          ></textarea>
        </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeAddModal()">
        Cancel
      </button>
      <button class="btn btn-primary" (click)="saveNewAsset()">Save</button>
    </div>
      </form>
    </div>
  </div>
</div>

<!-- Life Insurance Edit Modal -->
<div
  class="modal-overlay"
  *ngIf="showEditModal && currentAssetType === 'life_insurance'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header edit-modal-header">
      <h3>Edit Life Insurance Policy</h3>
      <button class="close-btn" (click)="closeEditModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingLifeInsurance">
      <form #form="ngForm">
        <!-- Insurance Company -->
        <div class="form-group">
          <label>Insurance Company *</label>
          <input
            type="text"
            [(ngModel)]="editingLifeInsurance.insurance_company"
            name="insurance_company"
            required
          />
        </div>

        <!-- Policy Type -->
        <div class="form-row">
          <div class="form-group">
            <label>Policy Type *</label>
            <select
              [(ngModel)]="editingLifeInsurance.policy_type"
              name="policy_type"
              required
            >
              <option value="term">Term</option>
              <option value="whole_life">Whole Life</option>
              <option value="universal">Universal</option>
              <option value="variable">Variable</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="form-group">
            <label>Policy Number</label>
            <input
              type="text"
              [(ngModel)]="editingLifeInsurance.policy_number"
              name="policy_number"
            />
          </div>
        </div>

        <!-- Financial Details -->
        <div class="form-row">
          <div class="form-group">
            <label>Face Value *</label>
            <input
              type="number"
              [(ngModel)]="editingLifeInsurance.face_value"
              name="face_value"
            />
          </div>
          <div class="form-group">
            <label>Death Benefit *</label>
            <input
              type="number"
              [(ngModel)]="editingLifeInsurance.approximate_value"
              name="approximate_value"
              required
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Cash Value</label>
            <input
              type="number"
              [(ngModel)]="editingLifeInsurance.cash_value"
              name="cash_value"
            />
          </div>
          <div class="form-group">
            <label>Annual Premium</label>
            <input
              type="number"
              [(ngModel)]="editingLifeInsurance.annual_premium"
              name="annual_premium"
            />
          </div>
        </div>

        <!-- Trust Ownership -->
        <div class="form-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="editingLifeInsurance.owned_by_trust"
              name="owned_by_trust"
            />
            Owned by Trust
          </label>
        </div>

        <div class="form-group" *ngIf="editingLifeInsurance.owned_by_trust">
          <label>Trust Name</label>
          <input
            type="text"
            [(ngModel)]="editingLifeInsurance.trust_name"
            name="trust_name"
          />
        </div>

        <!-- Ownership (for married couples) -->
        <div class="form-group" *ngIf="isMarried">
          <label>Owned By</label>
          <select
            [(ngModel)]="editingLifeInsurance.owned_by"
            name="owned_by"
            required
          >
            <option value="Joint">Joint</option>
            <option value="Client">Client</option>
            <option value="Spouse">Spouse</option>
          </select>
        </div>

<div class="form-group" *ngIf="isMarried">
  <label>Beneficiary Designation?</label>
  <div style="display: flex; align-items: center; gap: 1.5em;">
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="editingLifeInsurance.has_bene" name="has_bene" [value]="'Yes'" required /> Yes
    </label>
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="editingLifeInsurance.has_bene" name="has_bene" [value]="'No'" required /> No
    </label>
  </div>
</div>

<!-- Beneficiary Designation Section -->
<div *ngIf="editingLifeInsurance.has_bene === 'Yes'" class="beneficiary-designation-section">
  <div class="beneficiary-columns">
    <div class="beneficiary-column">
      <h4>Primary Beneficiaries</h4>
      <div class="distribution-type">
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="lifeInsurancePrimaryDistType" name="lifePrimaryDist" value="equal" (change)="recalculateLifeInsurancePrimary()"> Equal Amounts
        </label>
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="lifeInsurancePrimaryDistType" name="lifePrimaryDist" value="unequal"> Unequal Amounts
        </label>
      </div>
      <div class="beneficiary-selection">
        <div class="available-heirs">
          <h5>Available Heirs</h5>
          <div class="heir-list">
            <div *ngFor="let heir of getAvailablePrimaryHeirs('life_insurance')" class="heir-item clickable" (click)="addBeneficiary('life_insurance', 'primary', heir)">{{ heir.name }}</div>
            <div *ngIf="getAvailablePrimaryHeirs('life_insurance').length === 0" class="no-heirs">No available heirs</div>
          </div>
        </div>
        <div class="chosen-beneficiaries">
          <h5>Chosen</h5>
          <div class="beneficiary-list">
            <div *ngFor="let bene of getSafeBeneficiaryArray(editingLifeInsurance, 'primary_beneficiaries'); let i = index" class="beneficiary-item">
              <span class="bene-name">{{ bene.name }}</span>
              <input *ngIf="lifeInsurancePrimaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'lifePrimaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('life_insurance', 'primary', i)" class="percentage-input">
              <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
              <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
              <button type="button" class="btn-remove" (click)="removeBeneficiary('life_insurance', 'primary', i)">&times;</button>
            </div>
            <div *ngIf="editingLifeInsurance.primary_beneficiaries && editingLifeInsurance.primary_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
          </div>
          <div class="total-row" *ngIf="editingLifeInsurance.primary_beneficiaries && editingLifeInsurance.primary_beneficiaries.length > 0"><strong>Total: {{ getPrimaryTotal('life_insurance') | number:'1.2-2' }}%</strong></div>
        </div>
      </div>
    </div>
    <div class="beneficiary-column">
      <h4>Secondary Beneficiaries</h4>
      <div class="distribution-type">
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="lifeInsuranceSecondaryDistType" name="lifeSecondaryDist" value="equal" (change)="recalculateLifeInsuranceSecondary()"> Equal Amounts
        </label>
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="lifeInsuranceSecondaryDistType" name="lifeSecondaryDist" value="unequal"> Unequal Amounts
        </label>
      </div>
      <div class="beneficiary-selection">
        <div class="available-heirs">
          <h5>Available Heirs</h5>
          <div class="heir-list">
            <div *ngFor="let heir of getAvailableSecondaryHeirs('life_insurance')" class="heir-item clickable" (click)="addBeneficiary('life_insurance', 'secondary', heir)">{{ heir.name }}</div>
            <div *ngIf="getAvailableSecondaryHeirs('life_insurance').length === 0" class="no-heirs">No available heirs</div>
          </div>
        </div>
        <div class="chosen-beneficiaries">
          <h5>Chosen</h5>
          <div class="beneficiary-list">
            <div *ngFor="let bene of getSafeBeneficiaryArray(editingLifeInsurance, 'contingent_beneficiaries'); let i = index" class="beneficiary-item">
              <span class="bene-name">{{ bene.name }}</span>
              <input *ngIf="lifeInsuranceSecondaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'lifeSecondaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('life_insurance', 'secondary', i)" class="percentage-input">
              <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
              <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
              <button type="button" class="btn-remove" (click)="removeBeneficiary('life_insurance', 'secondary', i)">&times;</button>
            </div>
            <div *ngIf="editingLifeInsurance.contingent_beneficiaries && editingLifeInsurance.contingent_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
          </div>
          <div class="total-row" *ngIf="editingLifeInsurance.contingent_beneficiaries && editingLifeInsurance.contingent_beneficiaries.length > 0"><strong>Total: {{ getSecondaryTotal('life_insurance') | number:'1.2-2' }}%</strong></div>
        </div>
      </div>
    </div>
  </div>
</div>

        <!-- Notes -->
        <div class="form-group">
          <label>Notes</label>
          <textarea
            [(ngModel)]="editingLifeInsurance.notes"
            name="notes"
            rows="3"
          ></textarea>
        </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeEditModal()">
        Cancel
      </button>
      <button class="btn btn-primary" (click)="saveEditAsset()">
        Save Changes
      </button>
    </div>
      </form>
    </div>
  </div>
</div>

<!-- Business Interest Add Modal -->
<div
  class="modal-overlay"
  *ngIf="showAddModal && currentAssetType === 'business_interest'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header add-modal-header">
      <h3>Add Business Interest</h3>
      <button class="close-btn" (click)="closeAddModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingBusinessInterest">
      <form #form="ngForm">
        <!-- Business Name -->
        <div class="form-group">
          <label>Business Name *</label>
          <input
            type="text"
            [(ngModel)]="editingBusinessInterest.business_name"
            name="business_name"
            required
          />
        </div>

        <!-- Business Type and Ownership -->
        <div class="form-row">
          <div class="form-group">
            <label>Business Type *</label>
            <select
              [(ngModel)]="editingBusinessInterest.business_type"
              name="business_type"
              required
            >
              <option value="LLC">LLC</option>
              <option value="S_Corp">S Corporation</option>
              <option value="C_Corp">C Corporation</option>
              <option value="Partnership">Partnership</option>
              <option value="Sole_Prop">Sole Proprietorship</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="form-group">
            <label>Ownership Percentage</label>
            <input
              type="number"
              [(ngModel)]="editingBusinessInterest.ownership_percentage"
              name="ownership_percentage"
              min="0"
              max="100"
              required
            />
          </div>
        </div>

        <!-- Approximate Value -->
        <div class="form-group">
          <label>Approximate Value</label>
          <input
            type="number"
            [(ngModel)]="editingBusinessInterest.approximate_value"
            name="approximate_value"
            required
          />
        </div>

        <!-- Other Owners -->
        <div class="form-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="editingBusinessInterest.has_other_owners"
              name="has_other_owners"
            />
            Has Other Owners
          </label>
        </div>

        <div
          class="form-group"
          *ngIf="editingBusinessInterest.has_other_owners"
        >
          <label>Other Owners Names</label>
          <textarea
            [(ngModel)]="editingBusinessInterest.other_owners_names"
            name="other_owners_names"
            rows="2"
          ></textarea>
        </div>

        <!-- Buy-Sell Agreement -->
        <div class="form-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="editingBusinessInterest.buy_sell_agreement_exists"
              name="buy_sell_agreement_exists"
            />
            Buy-Sell Agreement Exists
          </label>
        </div>

        <div
          class="form-group"
          *ngIf="editingBusinessInterest.buy_sell_agreement_exists"
        >
          <label>Buy-Sell Document ID</label>
          <input
            type="number"
            [(ngModel)]="editingBusinessInterest.buy_sell_document_id"
            name="buy_sell_document_id"
          />
        </div>

        <!-- Succession Planning -->
        <div class="form-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="editingBusinessInterest.succession_plan_exists"
              name="succession_plan_exists"
            />
            Succession Plan Exists
          </label>
        </div>

        <div class="form-group">
          <label>Business Vision After Death</label>
          <textarea
            [(ngModel)]="editingBusinessInterest.business_vision_after_death"
            name="business_vision_after_death"
            rows="2"
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Intended Successor</label>
            <input
              type="text"
              [(ngModel)]="editingBusinessInterest.intended_successor"
              name="intended_successor"
            />
          </div>

          <div class="form-group">
            <label>Successor is Family</label>
            <select
              [(ngModel)]="editingBusinessInterest.successor_is_family"
              name="successor_is_family"
            >
              <option [ngValue]="null">Unknown</option>
              <option [ngValue]="true">Yes</option>
              <option [ngValue]="false">No</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>Should Business Be Sold</label>
          <select
            [(ngModel)]="editingBusinessInterest.should_business_be_sold"
            name="should_business_be_sold"
          >
            <option [ngValue]="null">Unknown</option>
            <option [ngValue]="true">Yes</option>
            <option [ngValue]="false">No</option>
          </select>
        </div>

        <!-- Ownership (for married couples) -->
        <div class="form-group" *ngIf="isMarried">
          <label>Owned By</label>
          <select
            [(ngModel)]="editingBusinessInterest.owned_by"
            name="owned_by"
            required
          >
            <option value="Joint">Joint</option>
            <option value="Client">Client</option>
            <option value="Spouse">Spouse</option>
          </select>
        </div>

        <div class="form-group" *ngIf="isMarried">
          <label>Beneficiary Designation?</label>
          <div style="display: flex; align-items: center; gap: 1.5em;">
            <label style="display: flex; align-items: center; gap: 0.3em;">
              <input type="radio" [(ngModel)]="editingBusinessInterest.has_bene" name="has_bene" [value]="'Yes'" required /> Yes
            </label>
            <label style="display: flex; align-items: center; gap: 0.3em;">
              <input type="radio" [(ngModel)]="editingBusinessInterest.has_bene" name="has_bene" [value]="'No'" required /> No
            </label>
          </div>
        </div>

<!-- Beneficiary Designation Section -->
<div *ngIf="editingBusinessInterest.has_bene === 'Yes'" class="beneficiary-designation-section">
  <div class="beneficiary-columns">
    <div class="beneficiary-column">
      <h4>Primary Beneficiaries</h4>
      <div class="distribution-type">
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="businessInterestPrimaryDistType" name="businessPrimaryDist" value="equal" (change)="recalculateBusinessInterestPrimary()"> Equal Amounts
        </label>
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="businessInterestPrimaryDistType" name="businessPrimaryDist" value="unequal"> Unequal Amounts
        </label>
      </div>
      <div class="beneficiary-selection">
        <div class="available-heirs">
          <h5>Available Heirs</h5>
          <div class="heir-list">
            <div *ngFor="let heir of getAvailablePrimaryHeirs('business_interest')" class="heir-item clickable" (click)="addBeneficiary('business_interest', 'primary', heir)">{{ heir.name }}</div>
            <div *ngIf="getAvailablePrimaryHeirs('business_interest').length === 0" class="no-heirs">No available heirs</div>
          </div>
        </div>
        <div class="chosen-beneficiaries">
          <h5>Chosen</h5>
          <div class="beneficiary-list">
            <div *ngFor="let bene of getSafeBeneficiaryArray(editingBusinessInterest, 'primary_beneficiaries'); let i = index" class="beneficiary-item">
              <span class="bene-name">{{ bene.name }}</span>
              <input *ngIf="businessInterestPrimaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'businessPrimaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('business_interest', 'primary', i)" class="percentage-input">
              <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
              <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
              <button type="button" class="btn-remove" (click)="removeBeneficiary('business_interest', 'primary', i)">&times;</button>
            </div>
            <div *ngIf="editingBusinessInterest.primary_beneficiaries && editingBusinessInterest.primary_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
          </div>
          <div class="total-row" *ngIf="editingBusinessInterest.primary_beneficiaries && editingBusinessInterest.primary_beneficiaries.length > 0"><strong>Total: {{ getPrimaryTotal('business_interest') | number:'1.2-2' }}%</strong></div>
        </div>
      </div>
    </div>
    <div class="beneficiary-column">
      <h4>Secondary Beneficiaries</h4>
      <div class="distribution-type">
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="businessInterestSecondaryDistType" name="businessSecondaryDist" value="equal" (change)="recalculateBusinessInterestSecondary()"> Equal Amounts
        </label>
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="businessInterestSecondaryDistType" name="businessSecondaryDist" value="unequal"> Unequal Amounts
        </label>
      </div>
      <div class="beneficiary-selection">
        <div class="available-heirs">
          <h5>Available Heirs</h5>
          <div class="heir-list">
            <div *ngFor="let heir of getAvailableSecondaryHeirs('business_interest')" class="heir-item clickable" (click)="addBeneficiary('business_interest', 'secondary', heir)">{{ heir.name }}</div>
            <div *ngIf="getAvailableSecondaryHeirs('business_interest').length === 0" class="no-heirs">No available heirs</div>
          </div>
        </div>
        <div class="chosen-beneficiaries">
          <h5>Chosen</h5>
          <div class="beneficiary-list">
            <div *ngFor="let bene of getSafeBeneficiaryArray(editingBusinessInterest, 'contingent_beneficiaries'); let i = index" class="beneficiary-item">
              <span class="bene-name">{{ bene.name }}</span>
              <input *ngIf="businessInterestSecondaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'businessSecondaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('business_interest', 'secondary', i)" class="percentage-input">
              <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
              <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
              <button type="button" class="btn-remove" (click)="removeBeneficiary('business_interest', 'secondary', i)">&times;</button>
            </div>
            <div *ngIf="editingBusinessInterest.contingent_beneficiaries && editingBusinessInterest.contingent_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
          </div>
          <div class="total-row" *ngIf="editingBusinessInterest.contingent_beneficiaries && editingBusinessInterest.contingent_beneficiaries.length > 0"><strong>Total: {{ getSecondaryTotal('business_interest') | number:'1.2-2' }}%</strong></div>
        </div>
      </div>
    </div>
  </div>
</div>

        <!-- Notes -->
        <div class="form-group">
          <label>Notes</label>
          <textarea
            [(ngModel)]="editingBusinessInterest.notes"
            name="notes"
            rows="3"
          ></textarea>
        </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeAddModal()">
        Cancel
      </button>
      <button class="btn btn-primary" (click)="saveNewAsset()">Save</button>
    </div>
      </form>
    </div>
  </div>
</div>

<!-- Business Interest Edit Modal -->
<div
  class="modal-overlay"
  *ngIf="showEditModal && currentAssetType === 'business_interest'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header edit-modal-header">
      <h3>Edit Business Interest</h3>
      <button class="close-btn" (click)="closeEditModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingBusinessInterest">
      <form #form="ngForm">
        <!-- Business Name -->
        <div class="form-group">
          <label>Business Name *</label>
          <input
            type="text"
            [(ngModel)]="editingBusinessInterest.business_name"
            name="business_name"
            required
          />
        </div>

        <!-- Business Type and Ownership -->
        <div class="form-row">
          <div class="form-group">
            <label>Business Type *</label>
            <select
              [(ngModel)]="editingBusinessInterest.business_type"
              name="business_type"
              required
            >
              <option value="LLC">LLC</option>
              <option value="S_Corp">S Corporation</option>
              <option value="C_Corp">C Corporation</option>
              <option value="Partnership">Partnership</option>
              <option value="Sole_Prop">Sole Proprietorship</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="form-group">
            <label>Ownership Percentage</label>
            <input
              type="number"
              [(ngModel)]="editingBusinessInterest.ownership_percentage"
              name="ownership_percentage"
              min="0"
              max="100"
              required
            />
          </div>
        </div>

        <!-- Approximate Value -->
        <div class="form-group">
          <label>Approximate Value</label>
          <input
            type="number"
            [(ngModel)]="editingBusinessInterest.approximate_value"
            name="approximate_value"
            required
          />
        </div>

        <!-- Other Owners -->
        <div class="form-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="editingBusinessInterest.has_other_owners"
              name="has_other_owners"
            />
            Has Other Owners
          </label>
        </div>

        <div
          class="form-group"
          *ngIf="editingBusinessInterest.has_other_owners"
        >
          <label>Other Owners Names</label>
          <textarea
            [(ngModel)]="editingBusinessInterest.other_owners_names"
            name="other_owners_names"
            rows="2"
          ></textarea>
        </div>

        <!-- Buy-Sell Agreement -->
        <div class="form-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="editingBusinessInterest.buy_sell_agreement_exists"
              name="buy_sell_agreement_exists"
            />
            Buy-Sell Agreement Exists
          </label>
        </div>

        <div
          class="form-group"
          *ngIf="editingBusinessInterest.buy_sell_agreement_exists"
        >
          <label>Buy-Sell Document ID</label>
          <input
            type="number"
            [(ngModel)]="editingBusinessInterest.buy_sell_document_id"
            name="buy_sell_document_id"
          />
        </div>

        <!-- Succession Planning -->
        <div class="form-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="editingBusinessInterest.succession_plan_exists"
              name="succession_plan_exists"
            />
            Succession Plan Exists
          </label>
        </div>

        <div class="form-group">
          <label>Business Vision After Death</label>
          <textarea
            [(ngModel)]="editingBusinessInterest.business_vision_after_death"
            name="business_vision_after_death"
            rows="2"
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Intended Successor</label>
            <input
              type="text"
              [(ngModel)]="editingBusinessInterest.intended_successor"
              name="intended_successor"
            />
          </div>

          <div class="form-group">
            <label>Successor is Family</label>
            <select
              [(ngModel)]="editingBusinessInterest.successor_is_family"
              name="successor_is_family"
            >
              <option [ngValue]="null">Unknown</option>
              <option [ngValue]="true">Yes</option>
              <option [ngValue]="false">No</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>Should Business Be Sold</label>
          <select
            [(ngModel)]="editingBusinessInterest.should_business_be_sold"
            name="should_business_be_sold"
          >
            <option [ngValue]="null">Unknown</option>
            <option [ngValue]="true">Yes</option>
            <option [ngValue]="false">No</option>
          </select>
        </div>

        <!-- Ownership (for married couples) -->
        <div class="form-group" *ngIf="isMarried">
          <label>Owned By</label>
          <select
            [(ngModel)]="editingBusinessInterest.owned_by"
            name="owned_by"
          >
            <option value="Joint">Joint</option>
            <option value="Client">Client</option>
            <option value="Spouse">Spouse</option>
          </select>
        </div>

<div class="form-group" *ngIf="isMarried">
  <label>Beneficiary Designation?</label>
  <div style="display: flex; align-items: center; gap: 1.5em;">
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="editingBusinessInterest.has_bene" name="has_bene" [value]="'Yes'" required /> Yes
    </label>
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="editingBusinessInterest.has_bene" name="has_bene" [value]="'No'" required /> No
    </label>
  </div>
</div>

<!-- Beneficiary Designation Section -->
<div *ngIf="editingBusinessInterest.has_bene === 'Yes'" class="beneficiary-designation-section">
  <div class="beneficiary-columns">
    <div class="beneficiary-column">
      <h4>Primary Beneficiaries</h4>
      <div class="distribution-type">
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="businessInterestPrimaryDistType" name="businessPrimaryDist" value="equal" (change)="recalculateBusinessInterestPrimary()"> Equal Amounts
        </label>
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="businessInterestPrimaryDistType" name="businessPrimaryDist" value="unequal"> Unequal Amounts
        </label>
      </div>
      <div class="beneficiary-selection">
        <div class="available-heirs">
          <h5>Available Heirs</h5>
          <div class="heir-list">
            <div *ngFor="let heir of getAvailablePrimaryHeirs('business_interest')" class="heir-item clickable" (click)="addBeneficiary('business_interest', 'primary', heir)">{{ heir.name }}</div>
            <div *ngIf="getAvailablePrimaryHeirs('business_interest').length === 0" class="no-heirs">No available heirs</div>
          </div>
        </div>
        <div class="chosen-beneficiaries">
          <h5>Chosen</h5>
          <div class="beneficiary-list">
            <div *ngFor="let bene of getSafeBeneficiaryArray(editingBusinessInterest, 'primary_beneficiaries'); let i = index" class="beneficiary-item">
              <span class="bene-name">{{ bene.name }}</span>
              <input *ngIf="businessInterestPrimaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'businessPrimaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('business_interest', 'primary', i)" class="percentage-input">
              <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
              <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
              <button type="button" class="btn-remove" (click)="removeBeneficiary('business_interest', 'primary', i)">&times;</button>
            </div>
            <div *ngIf="editingBusinessInterest.primary_beneficiaries && editingBusinessInterest.primary_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
          </div>
          <div class="total-row" *ngIf="editingBusinessInterest.primary_beneficiaries && editingBusinessInterest.primary_beneficiaries.length > 0"><strong>Total: {{ getPrimaryTotal('business_interest') | number:'1.2-2' }}%</strong></div>
        </div>
      </div>
    </div>
    <div class="beneficiary-column">
      <h4>Secondary Beneficiaries</h4>
      <div class="distribution-type">
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="businessInterestSecondaryDistType" name="businessSecondaryDist" value="equal" (change)="recalculateBusinessInterestSecondary()"> Equal Amounts
        </label>
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="businessInterestSecondaryDistType" name="businessSecondaryDist" value="unequal"> Unequal Amounts
        </label>
      </div>
      <div class="beneficiary-selection">
        <div class="available-heirs">
          <h5>Available Heirs</h5>
          <div class="heir-list">
            <div *ngFor="let heir of getAvailableSecondaryHeirs('business_interest')" class="heir-item clickable" (click)="addBeneficiary('business_interest', 'secondary', heir)">{{ heir.name }}</div>
            <div *ngIf="getAvailableSecondaryHeirs('business_interest').length === 0" class="no-heirs">No available heirs</div>
          </div>
        </div>
        <div class="chosen-beneficiaries">
          <h5>Chosen</h5>
          <div class="beneficiary-list">
            <div *ngFor="let bene of getSafeBeneficiaryArray(editingBusinessInterest, 'contingent_beneficiaries'); let i = index" class="beneficiary-item">
              <span class="bene-name">{{ bene.name }}</span>
              <input *ngIf="businessInterestSecondaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'businessSecondaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('business_interest', 'secondary', i)" class="percentage-input">
              <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
              <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
              <button type="button" class="btn-remove" (click)="removeBeneficiary('business_interest', 'secondary', i)">&times;</button>
            </div>
            <div *ngIf="editingBusinessInterest.contingent_beneficiaries && editingBusinessInterest.contingent_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
          </div>
          <div class="total-row" *ngIf="editingBusinessInterest.contingent_beneficiaries && editingBusinessInterest.contingent_beneficiaries.length > 0"><strong>Total: {{ getSecondaryTotal('business_interest') | number:'1.2-2' }}%</strong></div>
        </div>
      </div>
    </div>
  </div>
</div>

        <!-- Notes -->
        <div class="form-group">
          <label>Notes</label>
          <textarea
            [(ngModel)]="editingBusinessInterest.notes"
            name="notes"
            rows="3"
          ></textarea>
        </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeEditModal()">
        Cancel
      </button>
      <button class="btn btn-primary" (click)="saveEditAsset()">
        Save Changes
      </button>
    </div>
      </form>
    </div>
  </div>
</div>

<!-- Digital Asset Add Modal -->
<div
  class="modal-overlay"
  *ngIf="showAddModal && currentAssetType === 'digital_asset'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header add-modal-header">
      <h3>Add Digital Asset</h3>
      <button class="close-btn" (click)="closeAddModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingDigitalAsset">
      <form #form="ngForm">
        <!-- Asset Type -->
        <div class="form-group">
          <label>Asset Type *</label>
          <select
            [(ngModel)]="editingDigitalAsset.asset_type"
            name="asset_type"
            required
          >
            <option value="email">Email Account</option>
            <option value="social_media">Social Media</option>
            <option value="Cryptocurrency">Cryptocurrency</option>
            <option value="NFT">NFT</option>
            <option value="domain">Domain Name</option>
            <option value="website">Website</option>
            <option value="online_business">Online Business</option>
            <option value="cloud_storage">Cloud Storage</option>
            <option value="password_manager">Password Manager</option>
            <option value="digital_media">Digital Media/Content</option>
            <option value="loyalty_programs">Loyalty Programs</option>
            <option value="other">Other</option>
          </select>
        </div>

        <!-- Asset Name -->
        <div class="form-group">
          <label>Asset Name *</label>
          <input
            type="text"
            [(ngModel)]="editingDigitalAsset.asset_name"
            name="asset_name"
            required
          />
        </div>

        <!-- Platform/Service -->
        <div class="form-group">
          <label>Platform or Service</label>
          <input
            type="text"
            [(ngModel)]="editingDigitalAsset.platform_or_service"
            name="platform_or_service"
            placeholder="e.g., Facebook, Coinbase, GoDaddy"
          />
        </div>

        <!-- Approximate Value -->
        <div class="form-group">
          <label>Approximate Value</label>
          <input
            type="number"
            [(ngModel)]="editingDigitalAsset.approximate_value"
            name="approximate_value"
            required
          />
        </div>

        <!-- Username -->
        <div class="form-group">
          <label>Username</label>
          <input
            type="text"
            [(ngModel)]="editingDigitalAsset.username"
            name="username"
          />
        </div>

        <!-- Access Location -->
        <div class="form-group">
          <label>Access Location</label>
          <input
            type="text"
            [(ngModel)]="editingDigitalAsset.access_location"
            name="access_location"
            placeholder="Where password/credentials are stored"
          />
        </div>

        <!-- Crypto-specific fields -->
        <div
          *ngIf="
            editingDigitalAsset.asset_type === 'Cryptocurrency' ||
            editingDigitalAsset.asset_type === 'NFT'
          "
        >
          <div class="form-group">
            <label>Wallet Type</label>
            <input
              type="text"
              [(ngModel)]="editingDigitalAsset.wallet_type"
              name="wallet_type"
              placeholder="e.g., Hardware, Software, Exchange"
            />
          </div>

          <div class="form-group">
            <label>Seed Phrase Location</label>
            <input
              type="text"
              [(ngModel)]="editingDigitalAsset.seed_phrase_location"
              name="seed_phrase_location"
              placeholder="Where recovery phrase is stored"
            />
          </div>
        </div>

        <!-- Intended Disposition -->
        <div class="form-group">
          <label>Intended Disposition</label>
          <select
            [(ngModel)]="editingDigitalAsset.intended_disposition"
            name="intended_disposition"
          >
            <option [ngValue]="null">Not Specified</option>
            <option value="delete">Delete</option>
            <option value="preserve">Preserve</option>
            <option value="transfer">Transfer to Someone</option>
            <option value="memorialize">Memorialize</option>
          </select>
        </div>

        <!-- Access Instructions -->
        <div class="form-group">
          <label>Access Instructions</label>
          <textarea
            [(ngModel)]="editingDigitalAsset.access_instructions"
            name="access_instructions"
            rows="3"
            placeholder="How to access this asset after death"
          ></textarea>
        </div>

        <!-- Ownership (for married couples) -->
        <div class="form-group" *ngIf="isMarried">
          <label>Owned By</label>
          <select
            [(ngModel)]="editingDigitalAsset.owned_by"
            name="owned_by"
            required
          >
            <option value="Joint">Joint</option>
            <option value="Client">Client</option>
            <option value="Spouse">Spouse</option>
          </select>
        </div>

        <div class="form-group" *ngIf="isMarried">
          <label>Beneficiary Designation?</label>
          <div style="display: flex; align-items: center; gap: 1.5em;">
            <label style="display: flex; align-items: center; gap: 0.3em;">
              <input type="radio" [(ngModel)]="editingDigitalAsset.has_bene" name="has_bene" [value]="'Yes'" required /> Yes
            </label>
            <label style="display: flex; align-items: center; gap: 0.3em;">
              <input type="radio" [(ngModel)]="editingDigitalAsset.has_bene" name="has_bene" [value]="'No'" required /> No
            </label>
          </div>
        </div>

<!-- Beneficiary Designation Section -->
<div *ngIf="editingDigitalAsset.has_bene === 'Yes'" class="beneficiary-designation-section">
  <div class="beneficiary-columns">
    <div class="beneficiary-column">
      <h4>Primary Beneficiaries</h4>
      <div class="distribution-type">
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="digitalAssetPrimaryDistType" name="digitalPrimaryDist" value="equal" (change)="recalculateDigitalAssetPrimary()"> Equal Amounts
        </label>
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="digitalAssetPrimaryDistType" name="digitalPrimaryDist" value="unequal"> Unequal Amounts
        </label>
      </div>
      <div class="beneficiary-selection">
        <div class="available-heirs">
          <h5>Available Heirs</h5>
          <div class="heir-list">
            <div *ngFor="let heir of getAvailablePrimaryHeirs('digital_asset')" class="heir-item clickable" (click)="addBeneficiary('digital_asset', 'primary', heir)">{{ heir.name }}</div>
            <div *ngIf="getAvailablePrimaryHeirs('digital_asset').length === 0" class="no-heirs">No available heirs</div>
          </div>
        </div>
        <div class="chosen-beneficiaries">
          <h5>Chosen</h5>
          <div class="beneficiary-list">
            <div *ngFor="let bene of getSafeBeneficiaryArray(editingBusinessInterest, 'primary_beneficiaries'); let i = index" class="beneficiary-item">
              <span class="bene-name">{{ bene.name }}</span>
              <input *ngIf="digitalAssetPrimaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'digitalPrimaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('digital_asset', 'primary', i)" class="percentage-input">
              <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
              <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
              <button type="button" class="btn-remove" (click)="removeBeneficiary('digital_asset', 'primary', i)">&times;</button>
            </div>
            <div *ngIf="editingDigitalAsset.primary_beneficiaries && editingDigitalAsset.primary_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
          </div>
          <div class="total-row" *ngIf="editingDigitalAsset.primary_beneficiaries && editingDigitalAsset.primary_beneficiaries.length > 0"><strong>Total: {{ getPrimaryTotal('digital_asset') | number:'1.2-2' }}%</strong></div>
        </div>
      </div>
    </div>
    <div class="beneficiary-column">
      <h4>Secondary Beneficiaries</h4>
      <div class="distribution-type">
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="digitalAssetSecondaryDistType" name="digitalSecondaryDist" value="equal" (change)="recalculateDigitalAssetSecondary()"> Equal Amounts
        </label>
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="digitalAssetSecondaryDistType" name="digitalSecondaryDist" value="unequal"> Unequal Amounts
        </label>
      </div>
      <div class="beneficiary-selection">
        <div class="available-heirs">
          <h5>Available Heirs</h5>
          <div class="heir-list">
            <div *ngFor="let heir of getAvailableSecondaryHeirs('digital_asset')" class="heir-item clickable" (click)="addBeneficiary('digital_asset', 'secondary', heir)">{{ heir.name }}</div>
            <div *ngIf="getAvailableSecondaryHeirs('digital_asset').length === 0" class="no-heirs">No available heirs</div>
          </div>
        </div>
        <div class="chosen-beneficiaries">
          <h5>Chosen</h5>
          <div class="beneficiary-list">
            <div *ngFor="let bene of getSafeBeneficiaryArray(editingDigitalAsset, 'contingent_beneficiaries'); let i = index" class="beneficiary-item">
              <span class="bene-name">{{ bene.name }}</span>
              <input *ngIf="digitalAssetSecondaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'digitalSecondaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('digital_asset', 'secondary', i)" class="percentage-input">
              <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
              <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
              <button type="button" class="btn-remove" (click)="removeBeneficiary('digital_asset', 'secondary', i)">&times;</button>
            </div>
            <div *ngIf="editingDigitalAsset.contingent_beneficiaries && editingDigitalAsset.contingent_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
          </div>
          <div class="total-row" *ngIf="editingDigitalAsset.contingent_beneficiaries && editingDigitalAsset.contingent_beneficiaries.length > 0"><strong>Total: {{ getSecondaryTotal('digital_asset') | number:'1.2-2' }}%</strong></div>
        </div>
      </div>
    </div>
  </div>
</div>

        <!-- Notes -->
        <div class="form-group">
          <label>Notes</label>
          <textarea
            [(ngModel)]="editingDigitalAsset.notes"
            name="notes"
            rows="3"
          ></textarea>
        </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeAddModal()">
        Cancel
      </button>
      <button class="btn btn-primary" (click)="saveNewAsset()">Save</button>
    </div>
      </form>
    </div>
  </div>
</div>

<!-- Digital Asset Edit Modal -->
<div
  class="modal-overlay"
  *ngIf="showEditModal && currentAssetType === 'digital_asset'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header edit-modal-header">
      <h3>Edit Digital Asset</h3>
      <button class="close-btn" (click)="closeEditModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingDigitalAsset">
      <form #form="ngForm">
        <!-- Asset Type -->
        <div class="form-group">
          <label>Asset Type *</label>
          <select
            [(ngModel)]="editingDigitalAsset.asset_type"
            name="asset_type"
            required
          >
            <option value="email">Email Account</option>
            <option value="social_media">Social Media</option>
            <option value="Cryptocurrency">Cryptocurrency</option>
            <option value="NFT">NFT</option>
            <option value="domain">Domain Name</option>
            <option value="website">Website</option>
            <option value="online_business">Online Business</option>
            <option value="cloud_storage">Cloud Storage</option>
            <option value="password_manager">Password Manager</option>
            <option value="digital_media">Digital Media/Content</option>
            <option value="loyalty_programs">Loyalty Programs</option>
            <option value="other">Other</option>
          </select>
        </div>

        <!-- Asset Name -->
        <div class="form-group">
          <label>Asset Name *</label>
          <input
            type="text"
            [(ngModel)]="editingDigitalAsset.asset_name"
            name="asset_name"
            required
          />
        </div>

        <!-- Platform/Service -->
        <div class="form-group">
          <label>Platform or Service</label>
          <input
            type="text"
            [(ngModel)]="editingDigitalAsset.platform_or_service"
            name="platform_or_service"
            placeholder="e.g., Facebook, Coinbase, GoDaddy"
          />
        </div>

        <!-- Approximate Value -->
        <div class="form-group">
          <label>Approximate Value</label>
          <input
            type="number"
            [(ngModel)]="editingDigitalAsset.approximate_value"
            name="approximate_value"
            required
          />
        </div>

        <!-- Username -->
        <div class="form-group">
          <label>Username</label>
          <input
            type="text"
            [(ngModel)]="editingDigitalAsset.username"
            name="username"
          />
        </div>

        <!-- Access Location -->
        <div class="form-group">
          <label>Access Location</label>
          <input
            type="text"
            [(ngModel)]="editingDigitalAsset.access_location"
            name="access_location"
            placeholder="Where password/credentials are stored"
          />
        </div>

        <!-- Crypto-specific fields -->
        <div
          *ngIf="
            editingDigitalAsset.asset_type === 'Cryptocurrency' ||
            editingDigitalAsset.asset_type === 'NFT'
          "
        >
          <div class="form-group">
            <label>Wallet Type</label>
            <input
              type="text"
              [(ngModel)]="editingDigitalAsset.wallet_type"
              name="wallet_type"
              placeholder="e.g., Hardware, Software, Exchange"
            />
          </div>

          <div class="form-group">
            <label>Seed Phrase Location</label>
            <input
              type="text"
              [(ngModel)]="editingDigitalAsset.seed_phrase_location"
              name="seed_phrase_location"
              placeholder="Where recovery phrase is stored"
            />
          </div>
        </div>

        <!-- Intended Disposition -->
        <div class="form-group">
          <label>Intended Disposition</label>
          <select
            [(ngModel)]="editingDigitalAsset.intended_disposition"
            name="intended_disposition"
            required
          >
            <option [ngValue]="null">Not Specified</option>
            <option value="delete">Delete</option>
            <option value="preserve">Preserve</option>
            <option value="transfer">Transfer to Someone</option>
            <option value="memorialize">Memorialize</option>
          </select>
        </div>

        <!-- Access Instructions -->
        <div class="form-group">
          <label>Access Instructions</label>
          <textarea
            [(ngModel)]="editingDigitalAsset.access_instructions"
            name="access_instructions"
            rows="3"
            placeholder="How to access this asset after death"
          ></textarea>
        </div>

        <!-- Ownership (for married couples) -->
        <div class="form-group" *ngIf="isMarried">
          <label>Owned By</label>
          <select
            [(ngModel)]="editingDigitalAsset.owned_by"
            name="owned_by"
            required
          >
            <option value="Joint">Joint</option>
            <option value="Client">Client</option>
            <option value="Spouse">Spouse</option>
          </select>
        </div>

<div class="form-group" *ngIf="isMarried">
  <label>Beneficiary Designation?</label>
  <div style="display: flex; align-items: center; gap: 1.5em;">
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="editingDigitalAsset.has_bene" name="has_bene" [value]="'Yes'" required /> Yes
    </label>
    <label style="display: flex; align-items: center; gap: 0.3em;">
      <input type="radio" [(ngModel)]="editingDigitalAsset.has_bene" name="has_bene" [value]="'No'" required /> No
    </label>
  </div>
</div>

<!-- Beneficiary Designation Section -->
<div *ngIf="editingDigitalAsset.has_bene === 'Yes'" class="beneficiary-designation-section">
  <div class="beneficiary-columns">
    <div class="beneficiary-column">
      <h4>Primary Beneficiaries</h4>
      <div class="distribution-type">
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="digitalAssetPrimaryDistType" name="digitalPrimaryDist" value="equal" (change)="recalculateDigitalAssetPrimary()"> Equal Amounts
        </label>
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="digitalAssetPrimaryDistType" name="digitalPrimaryDist" value="unequal"> Unequal Amounts
        </label>
      </div>
      <div class="beneficiary-selection">
        <div class="available-heirs">
          <h5>Available Heirs</h5>
          <div class="heir-list">
            <div *ngFor="let heir of getAvailablePrimaryHeirs('digital_asset')" class="heir-item clickable" (click)="addBeneficiary('digital_asset', 'primary', heir)">{{ heir.name }}</div>
            <div *ngIf="getAvailablePrimaryHeirs('digital_asset').length === 0" class="no-heirs">No available heirs</div>
          </div>
        </div>
        <div class="chosen-beneficiaries">
          <h5>Chosen</h5>
          <div class="beneficiary-list">
            <div *ngFor="let bene of getSafeBeneficiaryArray(editingDigitalAsset, 'primary_beneficiaries'); let i = index" class="beneficiary-item">
              <span class="bene-name">{{ bene.name }}</span>
              <input *ngIf="digitalAssetPrimaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'digitalPrimaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('digital_asset', 'primary', i)" class="percentage-input">
              <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
              <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
              <button type="button" class="btn-remove" (click)="removeBeneficiary('digital_asset', 'primary', i)">&times;</button>
            </div>
            <div *ngIf="editingDigitalAsset.primary_beneficiaries && editingDigitalAsset.primary_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
          </div>
          <div class="total-row" *ngIf="editingDigitalAsset.primary_beneficiaries && editingDigitalAsset.primary_beneficiaries.length > 0"><strong>Total: {{ getPrimaryTotal('digital_asset') | number:'1.2-2' }}%</strong></div>
        </div>
      </div>
    </div>
    <div class="beneficiary-column">
      <h4>Secondary Beneficiaries</h4>
      <div class="distribution-type">
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="digitalAssetSecondaryDistType" name="digitalSecondaryDist" value="equal" (change)="recalculateDigitalAssetSecondary()"> Equal Amounts
        </label>
        <label style="display: flex; align-items: center; gap: 0.3em;">
          <input type="radio" [(ngModel)]="digitalAssetSecondaryDistType" name="digitalSecondaryDist" value="unequal"> Unequal Amounts
        </label>
      </div>
      <div class="beneficiary-selection">
        <div class="available-heirs">
          <h5>Available Heirs</h5>
          <div class="heir-list">
            <div *ngFor="let heir of getAvailableSecondaryHeirs('digital_asset')" class="heir-item clickable" (click)="addBeneficiary('digital_asset', 'secondary', heir)">{{ heir.name }}</div>
            <div *ngIf="getAvailableSecondaryHeirs('digital_asset').length === 0" class="no-heirs">No available heirs</div>
          </div>
        </div>
        <div class="chosen-beneficiaries">
          <h5>Chosen</h5>
          <div class="beneficiary-list">
            <div *ngFor="let bene of getSafeBeneficiaryArray(editingDigitalAsset, 'contingent_beneficiaries'); let i = index" class="beneficiary-item">
              <span class="bene-name">{{ bene.name }}</span>
              <input *ngIf="digitalAssetSecondaryDistType === 'unequal'" type="number" [(ngModel)]="bene.percentage" [name]="'digitalSecondaryPct' + i" min="0" max="100" step="0.01" (ngModelChange)="recalculateBeneficiaryValue('digital_asset', 'secondary', i)" class="percentage-input">
              <span class="bene-percentage">{{ (bene.percentage || 0) | number:'1.2-2' }}%</span>
              <span class="bene-value">{{ (bene.calculated_value || 0) | currency }}</span>
              <button type="button" class="btn-remove" (click)="removeBeneficiary('digital_asset', 'secondary', i)">&times;</button>
            </div>
            <div *ngIf="editingDigitalAsset.contingent_beneficiaries && editingDigitalAsset.contingent_beneficiaries.length === 0" class="no-beneficiaries">Click an heir to add</div>
          </div>
          <div class="total-row" *ngIf="editingDigitalAsset.contingent_beneficiaries && editingDigitalAsset.contingent_beneficiaries.length > 0"><strong>Total: {{ getSecondaryTotal('digital_asset') | number:'1.2-2' }}%</strong></div>
        </div>
      </div>
    </div>
  </div>
</div>

        <!-- Notes -->
        <div class="form-group">
          <label>Notes</label>
          <textarea
            [(ngModel)]="editingDigitalAsset.notes"
            name="notes"
            rows="3"
          ></textarea>
        </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeEditModal()">
        Cancel
      </button>
      <button class="btn btn-primary" (click)="saveEditAsset()">
        Save Changes
      </button>
    </div>
      </form>
    </div>
  </div>
</div>

<!-- Other Asset Add Modal -->
<div
  class="modal-overlay"
  *ngIf="showAddModal && currentAssetType === 'other_asset'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header add-modal-header">
      <h3>Add Other Asset</h3>
      <button class="close-btn" (click)="closeAddModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingOtherAsset">
      <form #form="ngForm">
        <!-- Asset Type -->
        <div class="form-group">
          <label>Asset Type *</label>
          <select
            [(ngModel)]="editingOtherAsset.asset_type"
            name="asset_type"
            required
          >
            <option value="vehicle">Vehicle</option>
            <option value="boat">Boat</option>
            <option value="rv">RV</option>
            <option value="Motorcycle">Motorcycle</option>
            <option value="Aircraft">Aircraft</option>
            <option value="Art">Art</option>
            <option value="Antiques">Antiques</option>
            <option value="Jewelry">Jewelry</option>
            <option value="Collectibles">Collectibles</option>
            <option value="Wine Collection">Wine Collection</option>
            <option value="Precious Metals">Precious Metals</option>
            <option value="Intellectual Property">Intellectual Property</option>
            <option value="Livestock">Livestock</option>
            <option value="Farm Equipment">Farm Equipment</option>
            <option value="Timeshare">Timeshare</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <!-- Description -->
        <div class="form-group">
          <label>Description *</label>
          <input
            type="text"
            [(ngModel)]="editingOtherAsset.description"
            name="description"
            required
            placeholder="Detailed description of the asset"
          />
        </div>

        <!-- Approximate Value -->
        <div class="form-group">
          <label>Approximate Value</label>
          <input
            type="number"
            [(ngModel)]="editingOtherAsset.approximate_value"
            name="approximate_value"
            required
          />
        </div>
        <!-- Vehicle Loan (only for vehicles) -->
        <div
          class="form-group"
          *ngIf="editingOtherAsset.asset_type === 'Vehicle'"
        >
          <label>Vehicle Loan</label>
          <input
            type="number"
            [(ngModel)]="editingOtherAsset.debtOwed"
            name="debtOwed"
            placeholder="Amount of vehicle loan"
            (ngModelChange)="onOtherAssetValueChange()"
          />
        </div>
        <!-- Net Value (auto-calculated) -->
        <div class="form-group">
          <label>Net Value</label>
          <input
            type="number"
            [(ngModel)]="editingOtherAsset.netValue"
            name="netValue"
            placeholder="Net value (estimated - debt)"
            readonly
          />
        </div>

        <!-- Heirloom Status -->
        <div class="form-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="editingOtherAsset.is_heirloom"
              name="is_heirloom"
            />
            Family Heirloom
          </label>
        </div>

        <!-- Intended Recipient -->
        <div class="form-group">
          <label>Intended Recipient</label>
          <input
            type="text"
            [(ngModel)]="editingOtherAsset.intended_recipient"
            name="intended_recipient"
            placeholder="Who should receive this asset"
          />
        </div>

        <!-- Special Instructions -->
        <div class="form-group">
          <label>Special Instructions</label>
          <textarea
            [(ngModel)]="editingOtherAsset.special_instructions"
            name="special_instructions"
            rows="3"
            placeholder="Any special handling or distribution instructions"
          ></textarea>
        </div>

        <!-- Appraisal Information -->
        <div class="form-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="editingOtherAsset.appraisal_exists"
              name="appraisal_exists"
            />
            Appraisal Exists
          </label>
        </div>

        <div class="form-group" *ngIf="editingOtherAsset.appraisal_exists">
          <label>Appraisal Date</label>
          <input
            type="date"
            [(ngModel)]="editingOtherAsset.appraisal_date"
            name="appraisal_date"
          />
        </div>

        <!-- Ownership (for married couples) -->
        <div class="form-group" *ngIf="isMarried">
          <label>Owned By</label>
          <select
            [(ngModel)]="editingOtherAsset.owned_by"
            name="owned_by"
            required
          >
            <option value="Joint">Joint</option>
            <option value="Client">Client</option>
            <option value="Spouse">Spouse</option>
          </select>
        </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeAddModal()">
        Cancel
      </button>
      <button class="btn btn-primary" (click)="saveNewAsset()">Save</button>
    </div>
      </form>
    </div>
  </div>
</div>

<!-- Other Asset Edit Modal -->
<div
  class="modal-overlay"
  *ngIf="showEditModal && currentAssetType === 'other_asset'"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header edit-modal-header">
      <h3>Edit Other Asset</h3>
      <button class="close-btn" (click)="closeEditModal()">&times;</button>
    </div>
    <div class="modal-body" *ngIf="editingOtherAsset">
      <form #form="ngForm">
        <!-- Asset Type -->
        <div class="form-group">
          <label>Asset Type *</label>
          <select
            [(ngModel)]="editingOtherAsset.asset_type"
            name="asset_type"
            required
          >
            <option value="Vehicle">Vehicle</option>
            <option value="Boat">Boat</option>
            <option value="RV">RV</option>
            <option value="Motorcycle">Motorcycle</option>
            <option value="Aircraft">Aircraft</option>
            <option value="Art">Art</option>
            <option value="Antiques">Antiques</option>
            <option value="Jewelry">Jewelry</option>
            <option value="Collectibles">Collectibles</option>
            <option value="Wine Collection">Wine Collection</option>
            <option value="Precious Metals">Precious Metals</option>
            <option value="Intellectual Property">Intellectual Property</option>
            <option value="Livestock">Livestock</option>
            <option value="Farm Equipment">Farm Equipment</option>
            <option value="Timeshare">Timeshare</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <!-- Description -->
        <div class="form-group">
          <label>Description *</label>
          <input
            type="text"
            [(ngModel)]="editingOtherAsset.description"
            name="description"
            required
            placeholder="Detailed description of the asset"
          />
        </div>

        <!-- Approximate Value -->
        <div class="form-group">
          <label>Approximate Value</label>
          <input
            type="number"
            [(ngModel)]="editingOtherAsset.approximate_value"
            name="approximate_value"
            (ngModelChange)="onOtherAssetValueChange()"
            required
          />
        </div>
        <!-- Vehicle Loan (only for vehicles) -->
        <div
          class="form-group"
          *ngIf="editingOtherAsset.asset_type === 'Vehicle'"
        >
          <label>Vehicle Loan</label>
          <input
            type="number"
            [(ngModel)]="editingOtherAsset.debtOwed"
            name="debtOwed"
            placeholder="Amount of vehicle loan"
            (ngModelChange)="onOtherAssetValueChange()"
          />
        </div>
        <!-- Net Value (auto-calculated) -->
        <div class="form-group">
          <label>Net Value</label>
          <input
            type="number"
            [(ngModel)]="editingOtherAsset.netValue"
            name="netValue"
            placeholder="Net value (estimated - debt)"
            readonly
          />
        </div>

        <!-- Heirloom Status -->
        <div class="form-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="editingOtherAsset.is_heirloom"
              name="is_heirloom"
            />
            Family Heirloom
          </label>
        </div>

        <!-- Intended Recipient -->
        <div class="form-group">
          <label>Intended Recipient</label>
          <input
            type="text"
            [(ngModel)]="editingOtherAsset.intended_recipient"
            name="intended_recipient"
            placeholder="Who should receive this asset"
          />
        </div>

        <!-- Special Instructions -->
        <div class="form-group">
          <label>Special Instructions</label>
          <textarea
            [(ngModel)]="editingOtherAsset.special_instructions"
            name="special_instructions"
            rows="3"
            placeholder="Any special handling or distribution instructions"
          ></textarea>
        </div>

        <!-- Appraisal Information -->
        <div class="form-group">
          <label>
            <input
              type="checkbox"
              [(ngModel)]="editingOtherAsset.appraisal_exists"
              name="appraisal_exists"
            />
            Appraisal Exists
          </label>
        </div>

        <div class="form-group" *ngIf="editingOtherAsset.appraisal_exists">
          <label>Appraisal Date</label>
          <input
            type="date"
            [(ngModel)]="editingOtherAsset.appraisal_date"
            name="appraisal_date"
          />
        </div>

        <!-- Ownership (for married couples) -->
        <div class="form-group" *ngIf="isMarried">
          <label>Owned By</label>
          <select
            [(ngModel)]="editingOtherAsset.owned_by"
            name="owned_by"
            required
          >
            <option value="Joint">Joint</option>
            <option value="Client">Client</option>
            <option value="Spouse">Spouse</option>
          </select>
        </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeEditModal()">
        Cancel
      </button>
      <button class="btn btn-primary" (click)="saveEditAsset()">
        Save Changes
      </button>
    </div>
      </form>
    </div>
  </div>
</div>

<!-- Table of All Assets and Debts -->
